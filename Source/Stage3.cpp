/*
  ==============================================================================

    Stage3.cpp
    Created: 21 Apr 2024 5:02:14pm
    Author:  Martin

  ==============================================================================
*/

#include "Stage3.h"

template <typename T, size_t cols, size_t rows>
class Matrix {
private:
    std::array<T, cols * rows> arr;
};

static std::array<float, 4> matrixMul(const std::array<float, 16>& A, const std::array<float, 4>& B) {
    std::array<float, 4> C;
    C[0] = A[0] * B[0] + A[1] * B[1] + A[2] * B[2] + A[3] * B[3];
    C[1] = A[4] * B[0] + A[5] * B[1] + A[6] * B[2] + A[7] * B[3];
    C[2] = A[8] * B[0] + A[9] * B[1] + A[10] * B[2] + A[11] * B[3];
    C[3] = A[12] * B[0] + A[13] * B[1] + A[14] * B[2] + A[15] * B[3];
    return C;
}

static std::array<float, 16> matrixMul(const std::array<float, 16>& A, const std::array<float, 16>& B) {
    std::array<float, 16> C;
    C[0] = A[0] * B[0] + A[1] * B[4] + A[2] * B[8] + A[3] * B[12];
    C[1] = A[0] * B[1] + A[1] * B[5] + A[2] * B[9] + A[3] * B[13];
    C[2] = A[0] * B[2] + A[1] * B[6] + A[2] * B[10] + A[3] * B[14];
    C[3] = A[0] * B[3] + A[1] * B[7] + A[2] * B[11] + A[3] * B[15];
    
    C[4] = A[4] * B[0] + A[5] * B[4] + A[6] * B[8] + A[7] * B[12];
    C[5] = A[4] * B[1] + A[5] * B[5] + A[6] * B[9] + A[7] * B[13];
    C[6] = A[4] * B[2] + A[5] * B[6] + A[6] * B[10] + A[7] * B[14];
    C[7] = A[4] * B[3] + A[5] * B[7] + A[6] * B[11] + A[7] * B[15];

    C[8] = A[8] * B[0] + A[9] * B[4] + A[10] * B[8] + A[11] * B[12];
    C[9] = A[8] * B[1] + A[9] * B[5] + A[10] * B[9] + A[11] * B[13];
    C[10] = A[8] * B[2] + A[9] * B[6] + A[10] * B[10] + A[11] * B[14];
    C[11] = A[8] * B[3] + A[9] * B[7] + A[10] * B[11] + A[11] * B[15];

    C[12] = A[12] * B[0] + A[13] * B[4] + A[14] * B[8] + A[15] * B[12];
    C[13] = A[12] * B[1] + A[13] * B[5] + A[14] * B[9] + A[15] * B[13];
    C[14] = A[12] * B[2] + A[13] * B[6] + A[14] * B[10] + A[15] * B[14];
    C[15] = A[12] * B[3] + A[13] * B[7] + A[14] * B[11] + A[15] * B[15];
    return C;
}

static float matrixMul(const std::array<float, 4>& A, const std::array<float, 4>& B) {
    return A[0] * B[0] + A[1] * B[1] + A[2] * B[2] + A[3] * B[3];
}

static std::array<float, 4> matrixMul(const std::array<float, 4>& A, float B) {
    std::array<float, 4> C{};
    for (int i = 0; i < A.size(); i++) {
        C[i] = B * A[i];
    }
    return C;
}

static std::array<float, 4> matrixAdd(const std::array<float, 4>& A, const std::array<float, 4>& B) {
    std::array<float, 4> C;
    C[0] = A[0] + B[0];
    C[0] = A[1] + B[1];
    C[0] = A[2] + B[2];
    C[0] = A[3] + B[3];
    return C;
}

static bool gluInvertMatrix(const std::array<float, 16>& m, std::array<float, 16>& invOut)
{
    std::array<float, 16> inv;
    float det;
    int i;

    inv[0] = m[5] * m[10] * m[15] -
        m[5] * m[11] * m[14] -
        m[9] * m[6] * m[15] +
        m[9] * m[7] * m[14] +
        m[13] * m[6] * m[11] -
        m[13] * m[7] * m[10];

    inv[4] = -m[4] * m[10] * m[15] +
        m[4] * m[11] * m[14] +
        m[8] * m[6] * m[15] -
        m[8] * m[7] * m[14] -
        m[12] * m[6] * m[11] +
        m[12] * m[7] * m[10];

    inv[8] = m[4] * m[9] * m[15] -
        m[4] * m[11] * m[13] -
        m[8] * m[5] * m[15] +
        m[8] * m[7] * m[13] +
        m[12] * m[5] * m[11] -
        m[12] * m[7] * m[9];

    inv[12] = -m[4] * m[9] * m[14] +
        m[4] * m[10] * m[13] +
        m[8] * m[5] * m[14] -
        m[8] * m[6] * m[13] -
        m[12] * m[5] * m[10] +
        m[12] * m[6] * m[9];

    inv[1] = -m[1] * m[10] * m[15] +
        m[1] * m[11] * m[14] +
        m[9] * m[2] * m[15] -
        m[9] * m[3] * m[14] -
        m[13] * m[2] * m[11] +
        m[13] * m[3] * m[10];

    inv[5] = m[0] * m[10] * m[15] -
        m[0] * m[11] * m[14] -
        m[8] * m[2] * m[15] +
        m[8] * m[3] * m[14] +
        m[12] * m[2] * m[11] -
        m[12] * m[3] * m[10];

    inv[9] = -m[0] * m[9] * m[15] +
        m[0] * m[11] * m[13] +
        m[8] * m[1] * m[15] -
        m[8] * m[3] * m[13] -
        m[12] * m[1] * m[11] +
        m[12] * m[3] * m[9];

    inv[13] = m[0] * m[9] * m[14] -
        m[0] * m[10] * m[13] -
        m[8] * m[1] * m[14] +
        m[8] * m[2] * m[13] +
        m[12] * m[1] * m[10] -
        m[12] * m[2] * m[9];

    inv[2] = m[1] * m[6] * m[15] -
        m[1] * m[7] * m[14] -
        m[5] * m[2] * m[15] +
        m[5] * m[3] * m[14] +
        m[13] * m[2] * m[7] -
        m[13] * m[3] * m[6];

    inv[6] = -m[0] * m[6] * m[15] +
        m[0] * m[7] * m[14] +
        m[4] * m[2] * m[15] -
        m[4] * m[3] * m[14] -
        m[12] * m[2] * m[7] +
        m[12] * m[3] * m[6];

    inv[10] = m[0] * m[5] * m[15] -
        m[0] * m[7] * m[13] -
        m[4] * m[1] * m[15] +
        m[4] * m[3] * m[13] +
        m[12] * m[1] * m[7] -
        m[12] * m[3] * m[5];

    inv[14] = -m[0] * m[5] * m[14] +
        m[0] * m[6] * m[13] +
        m[4] * m[1] * m[14] -
        m[4] * m[2] * m[13] -
        m[12] * m[1] * m[6] +
        m[12] * m[2] * m[5];

    inv[3] = -m[1] * m[6] * m[11] +
        m[1] * m[7] * m[10] +
        m[5] * m[2] * m[11] -
        m[5] * m[3] * m[10] -
        m[9] * m[2] * m[7] +
        m[9] * m[3] * m[6];

    inv[7] = m[0] * m[6] * m[11] -
        m[0] * m[7] * m[10] -
        m[4] * m[2] * m[11] +
        m[4] * m[3] * m[10] +
        m[8] * m[2] * m[7] -
        m[8] * m[3] * m[6];

    inv[11] = -m[0] * m[5] * m[11] +
        m[0] * m[7] * m[9] +
        m[4] * m[1] * m[11] -
        m[4] * m[3] * m[9] -
        m[8] * m[1] * m[7] +
        m[8] * m[3] * m[5];

    inv[15] = m[0] * m[5] * m[10] -
        m[0] * m[6] * m[9] -
        m[4] * m[1] * m[10] +
        m[4] * m[2] * m[9] +
        m[8] * m[1] * m[6] -
        m[8] * m[2] * m[5];

    det = m[0] * inv[0] + m[1] * inv[4] + m[2] * inv[8] + m[3] * inv[12];

    if (det == 0)
        return false;

    det = 1.0 / det;

    for (i = 0; i < 16; i++)
        invOut[i] = inv[i] * det;

    return true;
}

static float closestElementLinearInterpolate(const float x, const std::vector<float>& xArray, const std::vector<float>& yArray) {
    size_t size = xArray.size();
    if (x < xArray[0]) {
        return yArray[0];
    }
    else if (x > xArray[size - 1]) {
        return yArray[size - 1];
    }
    int i = 0, j = size, mid = 0;
    while (i < j) {
        mid = (i + j) / 2;

        if (xArray[mid] == x) {
            return yArray[mid];
        }

        if (x < xArray[mid]) {
            if (mid > 0 && x > xArray[mid - 1]) {
                float div = xArray[mid] - xArray[mid - 1];
                float mull = (xArray[mid] - x) / div;
                float mulr = (x - xArray[mid - 1]) / div;
                float test = xArray[mid - 1] * mull + xArray[mid] * mulr;
                return yArray[mid - 1] * mull + yArray[mid] * mulr;
            }
            j = mid;
        }
        else {
            if (mid < size - 1 && x < xArray[mid + 1]) {
                float div = xArray[mid + 1] - xArray[mid];
                float mull = (xArray[mid + 1] - x) / div;
                float mulr = (x - xArray[mid]) / div;
                float test = yArray[mid] * mull + yArray[mid + 1] * mulr;
                return yArray[mid] * mull + yArray[mid + 1] * mulr;
            }
            i = mid + 1;
        }
    }
    return yArray[mid];
}

void Stage3::configure(double sampleRate) {
    float T = static_cast<float>(1 / sampleRate);
    float h = static_cast<float>(2 * sampleRate);

    float R22 = 47000;
    float R33 = 6800;
    float R34 = 1000;
    float R37; //PARAMETER
    if (*this->odButton > 0.5) {
        R37 = 50000.0f + 0.01f - *this->odParameter;
    }
    else {
        R37 = 100000;
    }
    float C12 = 220e-9;
    float C18 = 470e-12;
    float E13 = 2.2e-6;
    float E14 = 2.2e-6;

    std::array<float, 16> A{ 0.0f };
    std::array<float, 4> B{ 0.0f };
    std::array<float, 4> C{ 0.0f };
    float F;


    A[0] = -1 / (C12 * (R37 + R34)) - 1 / (C12 * R33);
    A[1] = 0;
    A[2] = -1 / (C12 * (R37 + R34));
    A[3] = 0;
    A[4] = 1 / (C18 * (R37 + R34));
    A[5] = -1 / (R22 * C18);
    A[6] = 1 / (C18 * (R37 + R34));
    A[7] = 0;
    A[8] = -1 / (E13 * (R37 + R34));
    A[9] = 0;
    A[10] = -1 / (E13 * (R37 + R34));
    A[11] = 0;
    A[12] = 0;
    A[13] = 0;
    A[14] = 0;
    A[15] = 0;

    B[0] = -1 / (C12 * (R37 + R34));
    B[1] = 1 / (C18 * (R37 + R34));
    B[2] = -1 / (E13 * (R37 + R34));
    B[3] = 0;

    C[0] = R37 / (C12 * (R37 + R34));
    C[1] = -R37 / (C18 * (R37 + R34));
    C[2] = R37 / (E13 * (R37 + R34));
    C[3] = -1 / E14;

    this->D[0] = -R37 / (R37 + R34);
    this->D[1] = 1;
    this->D[2] = -R37 / (R37 + R34);
    this->D[3] = 1;

    this->E = R34 / (R34 + R37);
    F = -R34 * R37 / (R37 + R34);

    std::array<float, 16> I = { h,0,0,0,0,h,0,0,0,0,h,0,0,0,0,h };
    std::array<float, 16> IhmA{0};
    std::array<float, 16> IhpA{0};
    for (int i = 0; i < I.size(); i++) {
        IhmA[i] = I[i] - A[i];
        IhpA[i] = I[i] + A[i];
    }
    std::array<float, 16> inv{0};
    gluInvertMatrix(IhmA, inv);

    this->G = matrixMul(inv, C);
    this->H = matrixMul(inv, IhpA);
    this->J = matrixMul(inv, B);
    this->K = matrixMul(this->D, this->G) + F;

    for (int i = 0; i < this->x.size(); i++) {
        this->p[i] = (this->x[i] - this->K * this->y[i]);
    }
}

void Stage3::initParameters(std::atomic<float>* odParameter, std::atomic<float>* odButton) {
    this->odParameter = odParameter;
    this->odButton = odButton;

    //1001 points
    this->x = { -8.000000000000000e+01, -7.984000000000000e+01, -7.968000000000001e+01, -7.952000000000001e+01, -7.936000000000001e+01, -7.920000000000002e+01, -7.904000000000002e+01, -7.888000000000002e+01, -7.872000000000003e+01, -7.856000000000003e+01, -7.840000000000003e+01, -7.824000000000004e+01, -7.808000000000004e+01, -7.792000000000004e+01, -7.776000000000005e+01, -7.760000000000005e+01, -7.744000000000005e+01, -7.728000000000006e+01, -7.712000000000006e+01, -7.696000000000006e+01, -7.680000000000007e+01, -7.664000000000007e+01, -7.648000000000008e+01, -7.632000000000008e+01, -7.616000000000008e+01, -7.600000000000009e+01, -7.584000000000009e+01, -7.568000000000009e+01, -7.552000000000010e+01, -7.536000000000010e+01, -7.520000000000010e+01, -7.504000000000011e+01, -7.488000000000011e+01, -7.472000000000011e+01, -7.456000000000012e+01, -7.440000000000012e+01, -7.424000000000012e+01, -7.408000000000013e+01, -7.392000000000013e+01, -7.376000000000013e+01, -7.360000000000014e+01, -7.344000000000014e+01, -7.328000000000014e+01, -7.312000000000015e+01, -7.296000000000015e+01, -7.280000000000015e+01, -7.264000000000016e+01, -7.248000000000016e+01, -7.232000000000016e+01, -7.216000000000017e+01, -7.200000000000017e+01, -7.184000000000017e+01, -7.168000000000018e+01, -7.152000000000018e+01, -7.136000000000018e+01, -7.120000000000019e+01, -7.104000000000019e+01, -7.088000000000019e+01, -7.072000000000020e+01, -7.056000000000020e+01, -7.040000000000020e+01, -7.024000000000021e+01, -7.008000000000021e+01, -6.992000000000021e+01, -6.976000000000022e+01, -6.960000000000022e+01, -6.944000000000023e+01, -6.928000000000023e+01, -6.912000000000023e+01, -6.896000000000024e+01, -6.880000000000024e+01, -6.864000000000024e+01, -6.848000000000025e+01, -6.832000000000025e+01, -6.816000000000025e+01, -6.800000000000026e+01, -6.784000000000026e+01, -6.768000000000026e+01, -6.752000000000027e+01, -6.736000000000027e+01, -6.720000000000027e+01, -6.704000000000028e+01, -6.688000000000028e+01, -6.672000000000028e+01, -6.656000000000029e+01, -6.640000000000029e+01, -6.624000000000029e+01, -6.608000000000030e+01, -6.592000000000030e+01, -6.576000000000030e+01, -6.560000000000031e+01, -6.544000000000031e+01, -6.528000000000031e+01, -6.512000000000032e+01, -6.496000000000032e+01, -6.480000000000032e+01, -6.464000000000033e+01, -6.448000000000033e+01, -6.432000000000033e+01, -6.416000000000034e+01, -6.400000000000034e+01, -6.384000000000034e+01, -6.368000000000035e+01, -6.352000000000035e+01, -6.336000000000035e+01, -6.320000000000036e+01, -6.304000000000036e+01, -6.288000000000036e+01, -6.272000000000037e+01, -6.256000000000037e+01, -6.240000000000038e+01, -6.224000000000038e+01, -6.208000000000038e+01, -6.192000000000039e+01, -6.176000000000039e+01, -6.160000000000039e+01, -6.144000000000040e+01, -6.128000000000040e+01, -6.112000000000040e+01, -6.096000000000041e+01, -6.080000000000041e+01, -6.064000000000041e+01, -6.048000000000042e+01, -6.032000000000042e+01, -6.016000000000042e+01, -6.000000000000043e+01, -5.984000000000043e+01, -5.968000000000043e+01, -5.952000000000044e+01, -5.936000000000044e+01, -5.920000000000044e+01, -5.904000000000045e+01, -5.888000000000045e+01, -5.872000000000045e+01, -5.856000000000046e+01, -5.840000000000046e+01, -5.824000000000046e+01, -5.808000000000047e+01, -5.792000000000047e+01, -5.776000000000047e+01, -5.760000000000048e+01, -5.744000000000048e+01, -5.728000000000048e+01, -5.712000000000049e+01, -5.696000000000049e+01, -5.680000000000049e+01, -5.664000000000050e+01, -5.648000000000050e+01, -5.632000000000050e+01, -5.616000000000051e+01, -5.600000000000051e+01, -5.584000000000052e+01, -5.568000000000052e+01, -5.552000000000052e+01, -5.536000000000053e+01, -5.520000000000053e+01, -5.504000000000053e+01, -5.488000000000054e+01, -5.472000000000054e+01, -5.456000000000054e+01, -5.440000000000055e+01, -5.424000000000055e+01, -5.408000000000055e+01, -5.392000000000056e+01, -5.376000000000056e+01, -5.360000000000056e+01, -5.344000000000057e+01, -5.328000000000057e+01, -5.312000000000057e+01, -5.296000000000058e+01, -5.280000000000058e+01, -5.264000000000058e+01, -5.248000000000059e+01, -5.232000000000059e+01, -5.216000000000059e+01, -5.200000000000060e+01, -5.184000000000060e+01, -5.168000000000060e+01, -5.152000000000061e+01, -5.136000000000061e+01, -5.120000000000061e+01, -5.104000000000062e+01, -5.088000000000062e+01, -5.072000000000062e+01, -5.056000000000063e+01, -5.040000000000063e+01, -5.024000000000063e+01, -5.008000000000064e+01, -4.992000000000064e+01, -4.976000000000064e+01, -4.960000000000065e+01, -4.944000000000065e+01, -4.928000000000065e+01, -4.912000000000066e+01, -4.896000000000066e+01, -4.880000000000067e+01, -4.864000000000067e+01, -4.848000000000067e+01, -4.832000000000068e+01, -4.816000000000068e+01, -4.800000000000068e+01, -4.784000000000069e+01, -4.768000000000069e+01, -4.752000000000069e+01, -4.736000000000070e+01, -4.720000000000070e+01, -4.704000000000070e+01, -4.688000000000071e+01, -4.672000000000071e+01, -4.656000000000071e+01, -4.640000000000072e+01, -4.624000000000072e+01, -4.608000000000072e+01, -4.592000000000073e+01, -4.576000000000073e+01, -4.560000000000073e+01, -4.544000000000074e+01, -4.528000000000074e+01, -4.512000000000074e+01, -4.496000000000075e+01, -4.480000000000075e+01, -4.464000000000075e+01, -4.448000000000076e+01, -4.432000000000076e+01, -4.416000000000076e+01, -4.400000000000077e+01, -4.384000000000077e+01, -4.368000000000077e+01, -4.352000000000078e+01, -4.336000000000078e+01, -4.320000000000078e+01, -4.304000000000079e+01, -4.288000000000079e+01, -4.272000000000079e+01, -4.256000000000080e+01, -4.240000000000080e+01, -4.224000000000080e+01, -4.208000000000081e+01, -4.192000000000081e+01, -4.176000000000082e+01, -4.160000000000082e+01, -4.144000000000082e+01, -4.128000000000083e+01, -4.112000000000083e+01, -4.096000000000083e+01, -4.080000000000084e+01, -4.064000000000084e+01, -4.048000000000084e+01, -4.032000000000085e+01, -4.016000000000085e+01, -4.000000000000085e+01, -3.984000000000086e+01, -3.968000000000086e+01, -3.952000000000086e+01, -3.936000000000087e+01, -3.920000000000087e+01, -3.904000000000087e+01, -3.888000000000088e+01, -3.872000000000088e+01, -3.856000000000088e+01, -3.840000000000089e+01, -3.824000000000089e+01, -3.808000000000089e+01, -3.792000000000090e+01, -3.776000000000090e+01, -3.760000000000090e+01, -3.744000000000091e+01, -3.728000000000091e+01, -3.712000000000091e+01, -3.696000000000092e+01, -3.680000000000092e+01, -3.664000000000092e+01, -3.648000000000093e+01, -3.632000000000093e+01, -3.616000000000093e+01, -3.600000000000094e+01, -3.584000000000094e+01, -3.568000000000094e+01, -3.552000000000095e+01, -3.536000000000095e+01, -3.520000000000095e+01, -3.504000000000096e+01, -3.488000000000096e+01, -3.472000000000097e+01, -3.456000000000097e+01, -3.440000000000097e+01, -3.424000000000098e+01, -3.408000000000098e+01, -3.392000000000098e+01, -3.376000000000099e+01, -3.360000000000099e+01, -3.344000000000099e+01, -3.328000000000100e+01, -3.312000000000100e+01, -3.296000000000100e+01, -3.280000000000101e+01, -3.264000000000101e+01, -3.248000000000101e+01, -3.232000000000102e+01, -3.216000000000102e+01, -3.200000000000102e+01, -3.184000000000102e+01, -3.168000000000102e+01, -3.152000000000102e+01, -3.136000000000102e+01, -3.120000000000102e+01, -3.104000000000102e+01, -3.088000000000102e+01, -3.072000000000102e+01, -3.056000000000102e+01, -3.040000000000102e+01, -3.024000000000102e+01, -3.008000000000102e+01, -2.992000000000102e+01, -2.976000000000102e+01, -2.960000000000102e+01, -2.944000000000102e+01, -2.928000000000102e+01, -2.912000000000102e+01, -2.896000000000102e+01, -2.880000000000102e+01, -2.864000000000102e+01, -2.848000000000102e+01, -2.832000000000102e+01, -2.816000000000102e+01, -2.800000000000102e+01, -2.784000000000102e+01, -2.768000000000102e+01, -2.752000000000102e+01, -2.736000000000102e+01, -2.720000000000102e+01, -2.704000000000102e+01, -2.688000000000102e+01, -2.672000000000102e+01, -2.656000000000102e+01, -2.640000000000102e+01, -2.624000000000102e+01, -2.608000000000102e+01, -2.592000000000102e+01, -2.576000000000102e+01, -2.560000000000102e+01, -2.544000000000102e+01, -2.528000000000102e+01, -2.512000000000102e+01, -2.496000000000102e+01, -2.480000000000102e+01, -2.464000000000102e+01, -2.448000000000102e+01, -2.432000000000102e+01, -2.416000000000102e+01, -2.400000000000102e+01, -2.384000000000102e+01, -2.368000000000102e+01, -2.352000000000102e+01, -2.336000000000102e+01, -2.320000000000102e+01, -2.304000000000102e+01, -2.288000000000102e+01, -2.272000000000101e+01, -2.256000000000101e+01, -2.240000000000101e+01, -2.224000000000101e+01, -2.208000000000101e+01, -2.192000000000101e+01, -2.176000000000101e+01, -2.160000000000101e+01, -2.144000000000101e+01, -2.128000000000101e+01, -2.112000000000101e+01, -2.096000000000101e+01, -2.080000000000101e+01, -2.064000000000101e+01, -2.048000000000101e+01, -2.032000000000101e+01, -2.016000000000101e+01, -2.000000000000101e+01, -1.984000000000101e+01, -1.968000000000101e+01, -1.952000000000101e+01, -1.936000000000101e+01, -1.920000000000101e+01, -1.904000000000101e+01, -1.888000000000101e+01, -1.872000000000101e+01, -1.856000000000101e+01, -1.840000000000101e+01, -1.824000000000101e+01, -1.808000000000101e+01, -1.792000000000101e+01, -1.776000000000101e+01, -1.760000000000101e+01, -1.744000000000101e+01, -1.728000000000101e+01, -1.712000000000101e+01, -1.696000000000101e+01, -1.680000000000101e+01, -1.664000000000101e+01, -1.648000000000101e+01, -1.632000000000101e+01, -1.616000000000101e+01, -1.600000000000101e+01, -1.584000000000101e+01, -1.568000000000101e+01, -1.552000000000101e+01, -1.536000000000101e+01, -1.520000000000101e+01, -1.504000000000101e+01, -1.488000000000101e+01, -1.472000000000101e+01, -1.456000000000101e+01, -1.440000000000101e+01, -1.424000000000101e+01, -1.408000000000101e+01, -1.392000000000101e+01, -1.376000000000101e+01, -1.360000000000101e+01, -1.344000000000101e+01, -1.328000000000101e+01, -1.312000000000101e+01, -1.296000000000101e+01, -1.280000000000101e+01, -1.264000000000101e+01, -1.248000000000101e+01, -1.232000000000101e+01, -1.216000000000101e+01, -1.200000000000101e+01, -1.184000000000101e+01, -1.168000000000101e+01, -1.152000000000100e+01, -1.136000000000100e+01, -1.120000000000100e+01, -1.104000000000100e+01, -1.088000000000100e+01, -1.072000000000100e+01, -1.056000000000100e+01, -1.040000000000100e+01, -1.024000000000100e+01, -1.008000000000100e+01, -9.920000000001004e+00, -9.760000000001003e+00, -9.600000000001003e+00, -9.440000000001003e+00, -9.280000000001003e+00, -9.120000000001003e+00, -8.960000000001003e+00, -8.800000000001003e+00, -8.640000000001002e+00, -8.480000000001002e+00, -8.320000000001002e+00, -8.160000000001002e+00, -8.000000000001002e+00, -7.840000000001002e+00, -7.680000000001002e+00, -7.520000000001001e+00, -7.360000000001001e+00, -7.200000000001001e+00, -7.040000000001001e+00, -6.880000000001001e+00, -6.720000000001001e+00, -6.560000000001001e+00, -6.400000000001000e+00, -6.240000000001000e+00, -6.080000000001000e+00, -5.920000000001000e+00, -5.760000000001000e+00, -5.600000000001000e+00, -5.440000000001000e+00, -5.280000000000999e+00, -5.120000000000999e+00, -4.960000000000999e+00, -4.800000000000999e+00, -4.640000000000999e+00, -4.480000000000999e+00, -4.320000000000999e+00, -4.160000000000998e+00, -4.000000000000998e+00, -3.840000000000998e+00, -3.680000000000998e+00, -3.520000000000998e+00, -3.360000000000998e+00, -3.200000000000998e+00, -3.040000000000997e+00, -2.880000000000997e+00, -2.720000000000997e+00, -2.560000000000997e+00, -2.400000000000997e+00, -2.240000000000997e+00, -2.080000000000997e+00, -1.920000000000997e+00, -1.760000000000997e+00, -1.600000000000997e+00, -1.440000000000997e+00, -1.280000000000997e+00, -1.120000000000997e+00, -9.600000000009971e-01, -8.000000000009970e-01, -6.400000000009970e-01, -4.800000000009970e-01, -3.200000000009969e-01, -1.600000000009969e-01, -9.969247649621593e-13, 0.000000000000000e+00, 1.599999999990031e-01, 3.199999999990031e-01, 4.799999999990031e-01, 6.399999999990031e-01, 7.999999999990032e-01, 9.599999999990032e-01, 1.119999999999003e+00, 1.279999999999003e+00, 1.439999999999003e+00, 1.599999999999003e+00, 1.759999999999003e+00, 1.919999999999003e+00, 2.079999999999003e+00, 2.239999999999003e+00, 2.399999999999003e+00, 2.559999999999003e+00, 2.719999999999003e+00, 2.879999999999003e+00, 3.039999999999003e+00, 3.199999999999004e+00, 3.359999999999004e+00, 3.519999999999004e+00, 3.679999999999004e+00, 3.839999999999004e+00, 3.999999999999004e+00, 4.159999999999004e+00, 4.319999999999005e+00, 4.479999999999005e+00, 4.639999999999005e+00, 4.799999999999005e+00, 4.959999999999005e+00, 5.119999999999005e+00, 5.279999999999005e+00, 5.439999999999006e+00, 5.599999999999006e+00, 5.759999999999006e+00, 5.919999999999006e+00, 6.079999999999006e+00, 6.239999999999006e+00, 6.399999999999006e+00, 6.559999999999007e+00, 6.719999999999007e+00, 6.879999999999007e+00, 7.039999999999007e+00, 7.199999999999007e+00, 7.359999999999007e+00, 7.519999999999007e+00, 7.679999999999008e+00, 7.839999999999008e+00, 7.999999999999008e+00, 8.159999999999007e+00, 8.319999999999007e+00, 8.479999999999007e+00, 8.639999999999008e+00, 8.799999999999008e+00, 8.959999999999008e+00, 9.119999999999008e+00, 9.279999999999008e+00, 9.439999999999008e+00, 9.599999999999008e+00, 9.759999999999009e+00, 9.919999999999009e+00, 1.007999999999901e+01, 1.023999999999901e+01, 1.039999999999901e+01, 1.055999999999901e+01, 1.071999999999901e+01, 1.087999999999901e+01, 1.103999999999901e+01, 1.119999999999901e+01, 1.135999999999901e+01, 1.151999999999901e+01, 1.167999999999901e+01, 1.183999999999901e+01, 1.199999999999901e+01, 1.215999999999901e+01, 1.231999999999901e+01, 1.247999999999901e+01, 1.263999999999901e+01, 1.279999999999901e+01, 1.295999999999901e+01, 1.311999999999901e+01, 1.327999999999901e+01, 1.343999999999901e+01, 1.359999999999901e+01, 1.375999999999901e+01, 1.391999999999901e+01, 1.407999999999901e+01, 1.423999999999901e+01, 1.439999999999901e+01, 1.455999999999901e+01, 1.471999999999901e+01, 1.487999999999901e+01, 1.503999999999901e+01, 1.519999999999901e+01, 1.535999999999901e+01, 1.551999999999901e+01, 1.567999999999901e+01, 1.583999999999901e+01, 1.599999999999901e+01, 1.615999999999901e+01, 1.631999999999901e+01, 1.647999999999901e+01, 1.663999999999901e+01, 1.679999999999901e+01, 1.695999999999901e+01, 1.711999999999901e+01, 1.727999999999901e+01, 1.743999999999901e+01, 1.759999999999901e+01, 1.775999999999901e+01, 1.791999999999901e+01, 1.807999999999901e+01, 1.823999999999901e+01, 1.839999999999901e+01, 1.855999999999901e+01, 1.871999999999901e+01, 1.887999999999901e+01, 1.903999999999902e+01, 1.919999999999902e+01, 1.935999999999902e+01, 1.951999999999902e+01, 1.967999999999902e+01, 1.983999999999902e+01, 1.999999999999902e+01, 2.015999999999902e+01, 2.031999999999902e+01, 2.047999999999902e+01, 2.063999999999902e+01, 2.079999999999902e+01, 2.095999999999902e+01, 2.111999999999902e+01, 2.127999999999902e+01, 2.143999999999902e+01, 2.159999999999902e+01, 2.175999999999902e+01, 2.191999999999902e+01, 2.207999999999902e+01, 2.223999999999902e+01, 2.239999999999902e+01, 2.255999999999902e+01, 2.271999999999902e+01, 2.287999999999902e+01, 2.303999999999902e+01, 2.319999999999902e+01, 2.335999999999902e+01, 2.351999999999902e+01, 2.367999999999902e+01, 2.383999999999902e+01, 2.399999999999902e+01, 2.415999999999902e+01, 2.431999999999902e+01, 2.447999999999902e+01, 2.463999999999902e+01, 2.479999999999902e+01, 2.495999999999902e+01, 2.511999999999902e+01, 2.527999999999902e+01, 2.543999999999902e+01, 2.559999999999902e+01, 2.575999999999902e+01, 2.591999999999902e+01, 2.607999999999902e+01, 2.623999999999902e+01, 2.639999999999902e+01, 2.655999999999902e+01, 2.671999999999902e+01, 2.687999999999902e+01, 2.703999999999902e+01, 2.719999999999902e+01, 2.735999999999902e+01, 2.751999999999902e+01, 2.767999999999902e+01, 2.783999999999902e+01, 2.799999999999902e+01, 2.815999999999902e+01, 2.831999999999902e+01, 2.847999999999902e+01, 2.863999999999902e+01, 2.879999999999902e+01, 2.895999999999902e+01, 2.911999999999902e+01, 2.927999999999902e+01, 2.943999999999902e+01, 2.959999999999902e+01, 2.975999999999902e+01, 2.991999999999902e+01, 3.007999999999902e+01, 3.023999999999902e+01, 3.039999999999903e+01, 3.055999999999903e+01, 3.071999999999903e+01, 3.087999999999903e+01, 3.103999999999903e+01, 3.119999999999903e+01, 3.135999999999903e+01, 3.151999999999903e+01, 3.167999999999903e+01, 3.183999999999903e+01, 3.199999999999903e+01, 3.215999999999902e+01, 3.231999999999902e+01, 3.247999999999902e+01, 3.263999999999901e+01, 3.279999999999901e+01, 3.295999999999901e+01, 3.311999999999900e+01, 3.327999999999900e+01, 3.343999999999900e+01, 3.359999999999899e+01, 3.375999999999899e+01, 3.391999999999899e+01, 3.407999999999898e+01, 3.423999999999898e+01, 3.439999999999898e+01, 3.455999999999897e+01, 3.471999999999897e+01, 3.487999999999897e+01, 3.503999999999896e+01, 3.519999999999896e+01, 3.535999999999895e+01, 3.551999999999895e+01, 3.567999999999895e+01, 3.583999999999894e+01, 3.599999999999894e+01, 3.615999999999894e+01, 3.631999999999893e+01, 3.647999999999893e+01, 3.663999999999893e+01, 3.679999999999892e+01, 3.695999999999892e+01, 3.711999999999892e+01, 3.727999999999891e+01, 3.743999999999891e+01, 3.759999999999891e+01, 3.775999999999890e+01, 3.791999999999890e+01, 3.807999999999890e+01, 3.823999999999889e+01, 3.839999999999889e+01, 3.855999999999889e+01, 3.871999999999888e+01, 3.887999999999888e+01, 3.903999999999888e+01, 3.919999999999887e+01, 3.935999999999887e+01, 3.951999999999887e+01, 3.967999999999886e+01, 3.983999999999886e+01, 3.999999999999886e+01, 4.015999999999885e+01, 4.031999999999885e+01, 4.047999999999885e+01, 4.063999999999884e+01, 4.079999999999884e+01, 4.095999999999884e+01, 4.111999999999883e+01, 4.127999999999883e+01, 4.143999999999883e+01, 4.159999999999882e+01, 4.175999999999882e+01, 4.191999999999882e+01, 4.207999999999881e+01, 4.223999999999881e+01, 4.239999999999880e+01, 4.255999999999880e+01, 4.271999999999880e+01, 4.287999999999879e+01, 4.303999999999879e+01, 4.319999999999879e+01, 4.335999999999878e+01, 4.351999999999878e+01, 4.367999999999878e+01, 4.383999999999877e+01, 4.399999999999877e+01, 4.415999999999877e+01, 4.431999999999876e+01, 4.447999999999876e+01, 4.463999999999876e+01, 4.479999999999875e+01, 4.495999999999875e+01, 4.511999999999875e+01, 4.527999999999874e+01, 4.543999999999874e+01, 4.559999999999874e+01, 4.575999999999873e+01, 4.591999999999873e+01, 4.607999999999873e+01, 4.623999999999872e+01, 4.639999999999872e+01, 4.655999999999872e+01, 4.671999999999871e+01, 4.687999999999871e+01, 4.703999999999871e+01, 4.719999999999870e+01, 4.735999999999870e+01, 4.751999999999870e+01, 4.767999999999869e+01, 4.783999999999869e+01, 4.799999999999869e+01, 4.815999999999868e+01, 4.831999999999868e+01, 4.847999999999868e+01, 4.863999999999867e+01, 4.879999999999867e+01, 4.895999999999867e+01, 4.911999999999866e+01, 4.927999999999866e+01, 4.943999999999865e+01, 4.959999999999865e+01, 4.975999999999865e+01, 4.991999999999864e+01, 5.007999999999864e+01, 5.023999999999864e+01, 5.039999999999863e+01, 5.055999999999863e+01, 5.071999999999863e+01, 5.087999999999862e+01, 5.103999999999862e+01, 5.119999999999862e+01, 5.135999999999861e+01, 5.151999999999861e+01, 5.167999999999861e+01, 5.183999999999860e+01, 5.199999999999860e+01, 5.215999999999860e+01, 5.231999999999859e+01, 5.247999999999859e+01, 5.263999999999859e+01, 5.279999999999858e+01, 5.295999999999858e+01, 5.311999999999858e+01, 5.327999999999857e+01, 5.343999999999857e+01, 5.359999999999857e+01, 5.375999999999856e+01, 5.391999999999856e+01, 5.407999999999856e+01, 5.423999999999855e+01, 5.439999999999855e+01, 5.455999999999855e+01, 5.471999999999854e+01, 5.487999999999854e+01, 5.503999999999854e+01, 5.519999999999853e+01, 5.535999999999853e+01, 5.551999999999853e+01, 5.567999999999852e+01, 5.583999999999852e+01, 5.599999999999851e+01, 5.615999999999851e+01, 5.631999999999851e+01, 5.647999999999850e+01, 5.663999999999850e+01, 5.679999999999850e+01, 5.695999999999849e+01, 5.711999999999849e+01, 5.727999999999849e+01, 5.743999999999848e+01, 5.759999999999848e+01, 5.775999999999848e+01, 5.791999999999847e+01, 5.807999999999847e+01, 5.823999999999847e+01, 5.839999999999846e+01, 5.855999999999846e+01, 5.871999999999846e+01, 5.887999999999845e+01, 5.903999999999845e+01, 5.919999999999845e+01, 5.935999999999844e+01, 5.951999999999844e+01, 5.967999999999844e+01, 5.983999999999843e+01, 5.999999999999843e+01, 6.015999999999843e+01, 6.031999999999842e+01, 6.047999999999842e+01, 6.063999999999842e+01, 6.079999999999841e+01, 6.095999999999841e+01, 6.111999999999841e+01, 6.127999999999840e+01, 6.143999999999840e+01, 6.159999999999840e+01, 6.175999999999839e+01, 6.191999999999839e+01, 6.207999999999839e+01, 6.223999999999838e+01, 6.239999999999838e+01, 6.255999999999838e+01, 6.271999999999837e+01, 6.287999999999837e+01, 6.303999999999836e+01, 6.319999999999836e+01, 6.335999999999836e+01, 6.351999999999835e+01, 6.367999999999835e+01, 6.383999999999835e+01, 6.399999999999834e+01, 6.415999999999835e+01, 6.431999999999834e+01, 6.447999999999834e+01, 6.463999999999834e+01, 6.479999999999833e+01, 6.495999999999833e+01, 6.511999999999833e+01, 6.527999999999832e+01, 6.543999999999832e+01, 6.559999999999832e+01, 6.575999999999831e+01, 6.591999999999831e+01, 6.607999999999831e+01, 6.623999999999830e+01, 6.639999999999830e+01, 6.655999999999830e+01, 6.671999999999829e+01, 6.687999999999829e+01, 6.703999999999829e+01, 6.719999999999828e+01, 6.735999999999828e+01, 6.751999999999828e+01, 6.767999999999827e+01, 6.783999999999827e+01, 6.799999999999827e+01, 6.815999999999826e+01, 6.831999999999826e+01, 6.847999999999826e+01, 6.863999999999825e+01, 6.879999999999825e+01, 6.895999999999825e+01, 6.911999999999824e+01, 6.927999999999824e+01, 6.943999999999824e+01, 6.959999999999823e+01, 6.975999999999823e+01, 6.991999999999823e+01, 7.007999999999822e+01, 7.023999999999822e+01, 7.039999999999822e+01, 7.055999999999821e+01, 7.071999999999821e+01, 7.087999999999820e+01, 7.103999999999820e+01, 7.119999999999820e+01, 7.135999999999819e+01, 7.151999999999819e+01, 7.167999999999819e+01, 7.183999999999818e+01, 7.199999999999818e+01, 7.215999999999818e+01, 7.231999999999817e+01, 7.247999999999817e+01, 7.263999999999817e+01, 7.279999999999816e+01, 7.295999999999816e+01, 7.311999999999816e+01, 7.327999999999815e+01, 7.343999999999815e+01, 7.359999999999815e+01, 7.375999999999814e+01, 7.391999999999814e+01, 7.407999999999814e+01, 7.423999999999813e+01, 7.439999999999813e+01, 7.455999999999813e+01, 7.471999999999812e+01, 7.487999999999812e+01, 7.503999999999812e+01, 7.519999999999811e+01, 7.535999999999811e+01, 7.551999999999811e+01, 7.567999999999810e+01, 7.583999999999810e+01, 7.599999999999810e+01, 7.615999999999809e+01, 7.631999999999809e+01, 7.647999999999809e+01, 7.663999999999808e+01, 7.679999999999808e+01, 7.695999999999808e+01, 7.711999999999807e+01, 7.727999999999807e+01, 7.743999999999807e+01, 7.759999999999806e+01, 7.775999999999806e+01, 7.791999999999805e+01, 7.807999999999805e+01, 7.823999999999805e+01, 7.839999999999804e+01, 7.855999999999804e+01, 7.871999999999804e+01, 7.887999999999803e+01, 7.903999999999803e+01, 7.919999999999803e+01, 7.935999999999802e+01, 7.951999999999802e+01, 7.967999999999802e+01, 7.983999999999801e+01, 8.000000000000000e+01 };
    this->y = { -2.935037860132590e-02, -2.929116565856046e-02, -2.923195285267684e-02, -2.917274008143080e-02, -2.911352737927451e-02, -2.905431474648981e-02, -2.899510218335938e-02, -2.893588969016777e-02, -2.887667726720124e-02, -2.881746491474785e-02, -2.875825263309740e-02, -2.869904042254152e-02, -2.863982828337359e-02, -2.858061621588888e-02, -2.852140422038443e-02, -2.846219229715916e-02, -2.840298044651385e-02, -2.834376866875118e-02, -2.828455696417569e-02, -2.822534533309387e-02, -2.816613377581410e-02, -2.810692229264675e-02, -2.804771088390411e-02, -2.798849954990048e-02, -2.792928829095212e-02, -2.787007710737734e-02, -2.781086599949645e-02, -2.775165496763183e-02, -2.769244401210789e-02, -2.763323313325115e-02, -2.757402233139022e-02, -2.751481160685582e-02, -2.745560095998082e-02, -2.739639039110022e-02, -2.733717990055122e-02, -2.727796948867319e-02, -2.721875915580773e-02, -2.715954890229863e-02, -2.710033872849198e-02, -2.704112863473611e-02, -2.698191862138163e-02, -2.692270868878147e-02, -2.686349883729090e-02, -2.680428906726751e-02, -2.674507937907129e-02, -2.668586977306460e-02, -2.662666024961223e-02, -2.656745080908138e-02, -2.650824145184172e-02, -2.644903217826539e-02, -2.638982298872704e-02, -2.633061388360385e-02, -2.627140486327550e-02, -2.621219592812429e-02, -2.615298707853507e-02, -2.609377831489533e-02, -2.603456963759519e-02, -2.597536104702743e-02, -2.591615254358751e-02, -2.585694412767361e-02, -2.579773579968663e-02, -2.573852756003027e-02, -2.567931940911096e-02, -2.562011134733798e-02, -2.556090337512343e-02, -2.550169549288229e-02, -2.544248770103241e-02, -2.538327999999457e-02, -2.532407239019250e-02, -2.526486487205288e-02, -2.520565744600540e-02, -2.514645011248279e-02, -2.508724287192083e-02, -2.502803572475838e-02, -2.496882867143741e-02, -2.490962171240304e-02, -2.485041484810358e-02, -2.479120807899051e-02, -2.473200140551857e-02, -2.467279482814576e-02, -2.461358834733338e-02, -2.455438196354605e-02, -2.449517567725175e-02, -2.443596948892187e-02, -2.437676339903120e-02, -2.431755740805802e-02, -2.425835151648409e-02, -2.419914572479467e-02, -2.413994003347863e-02, -2.408073444302841e-02, -2.402152895394007e-02, -2.396232356671337e-02, -2.390311828185174e-02, -2.384391309986239e-02, -2.378470802125627e-02, -2.372550304654816e-02, -2.366629817625670e-02, -2.360709341090442e-02, -2.354788875101778e-02, -2.348868419712720e-02, -2.342947974976711e-02, -2.337027540947603e-02, -2.331107117679652e-02, -2.325186705227531e-02, -2.319266303646329e-02, -2.313345912991556e-02, -2.307425533319150e-02, -2.301505164685480e-02, -2.295584807147348e-02, -2.289664460761996e-02, -2.283744125587111e-02, -2.277823801680827e-02, -2.271903489101733e-02, -2.265983187908876e-02, -2.260062898161763e-02, -2.254142619920373e-02, -2.248222353245153e-02, -2.242302098197031e-02, -2.236381854837416e-02, -2.230461623228205e-02, -2.224541403431788e-02, -2.218621195511052e-02, -2.212700999529389e-02, -2.206780815550700e-02, -2.200860643639397e-02, -2.194940483860417e-02, -2.189020336279217e-02, -2.183100200961789e-02, -2.177180077974660e-02, -2.171259967384900e-02, -2.165339869260128e-02, -2.159419783668518e-02, -2.153499710678802e-02, -2.147579650360282e-02, -2.141659602782832e-02, -2.135739568016905e-02, -2.129819546133540e-02, -2.123899537204369e-02, -2.117979541301621e-02, -2.112059558498134e-02, -2.106139588867354e-02, -2.100219632483352e-02, -2.094299689420820e-02, -2.088379759755085e-02, -2.082459843562116e-02, -2.076539940918529e-02, -2.070620051901594e-02, -2.064700176589247e-02, -2.058780315060089e-02, -2.052860467393405e-02, -2.046940633669162e-02, -2.041020813968021e-02, -2.035101008371347e-02, -2.029181216961213e-02, -2.023261439820410e-02, -2.017341677032457e-02, -2.011421928681608e-02, -2.005502194852861e-02, -1.999582475631965e-02, -1.993662771105432e-02, -1.987743081360546e-02, -1.981823406485367e-02, -1.975903746568747e-02, -1.969984101700336e-02, -1.964064471970591e-02, -1.958144857470789e-02, -1.952225258293032e-02, -1.946305674530261e-02, -1.940386106276267e-02, -1.934466553625696e-02, -1.928547016674066e-02, -1.922627495517771e-02, -1.916707990254098e-02, -1.910788500981234e-02, -1.904869027798279e-02, -1.898949570805258e-02, -1.893030130103129e-02, -1.887110705793798e-02, -1.881191297980131e-02, -1.875271906765964e-02, -1.869352532256115e-02, -1.863433174556400e-02, -1.857513833773642e-02, -1.851594510015685e-02, -1.845675203391408e-02, -1.839755914010738e-02, -1.833836641984662e-02, -1.827917387425241e-02, -1.821998150445626e-02, -1.816078931160070e-02, -1.810159729683943e-02, -1.804240546133747e-02, -1.798321380627131e-02, -1.792402233282905e-02, -1.786483104221057e-02, -1.780563993562765e-02, -1.774644901430418e-02, -1.768725827947629e-02, -1.762806773239252e-02, -1.756887737431397e-02, -1.750968720651451e-02, -1.745049723028091e-02, -1.739130744691305e-02, -1.733211785772406e-02, -1.727292846404052e-02, -1.721373926720268e-02, -1.715455026856459e-02, -1.709536146949431e-02, -1.703617287137412e-02, -1.697698447560071e-02, -1.691779628358536e-02, -1.685860829675418e-02, -1.679942051654829e-02, -1.674023294442404e-02, -1.668104558185323e-02, -1.662185843032333e-02, -1.656267149133769e-02, -1.650348476641578e-02, -1.644429825709341e-02, -1.638511196492298e-02, -1.632592589147373e-02, -1.626674003833191e-02, -1.620755440710115e-02, -1.614836899940260e-02, -1.608918381687525e-02, -1.602999886117618e-02, -1.597081413398081e-02, -1.591162963698321e-02, -1.585244537189632e-02, -1.579326134045229e-02, -1.573407754440273e-02, -1.567489398551901e-02, -1.561571066559258e-02, -1.555652758643525e-02, -1.549734474987949e-02, -1.543816215777879e-02, -1.537897981200794e-02, -1.531979771446336e-02, -1.526061586706348e-02, -1.520143427174902e-02, -1.514225293048337e-02, -1.508307184525295e-02, -1.502389101806756e-02, -1.496471045096072e-02, -1.490553014599011e-02, -1.484635010523790e-02, -1.478717033081117e-02, -1.472799082484228e-02, -1.466881158948930e-02, -1.460963262693642e-02, -1.455045393939437e-02, -1.449127552910084e-02, -1.443209739832095e-02, -1.437291954934768e-02, -1.431374198450231e-02, -1.425456470613494e-02, -1.419538771662490e-02, -1.413621101838132e-02, -1.407703461384353e-02, -1.401785850548167e-02, -1.395868269579713e-02, -1.389950718732311e-02, -1.384033198262518e-02, -1.378115708430181e-02, -1.372198249498493e-02, -1.366280821734051e-02, -1.360363425406919e-02, -1.354446060790683e-02, -1.348528728162512e-02, -1.342611427803228e-02, -1.336694159997362e-02, -1.330776925033225e-02, -1.324859723202974e-02, -1.318942554802679e-02, -1.313025420132395e-02, -1.307108319496234e-02, -1.301191253202437e-02, -1.295274221563448e-02, -1.289357224895996e-02, -1.283440263521168e-02, -1.277523337764491e-02, -1.271606447956017e-02, -1.265689594430402e-02, -1.259772777526998e-02, -1.253855997589934e-02, -1.247939254968216e-02, -1.242022550015808e-02, -1.236105883091736e-02, -1.230189254560180e-02, -1.224272664790572e-02, -1.218356114157703e-02, -1.212439603041822e-02, -1.206523131828743e-02, -1.200606700909959e-02, -1.194690310682745e-02, -1.188773961550282e-02, -1.182857653921769e-02, -1.176941388212542e-02, -1.171025164844204e-02, -1.165108984244744e-02, -1.159192846848673e-02, -1.153276753097151e-02, -1.147360703438129e-02, -1.141444698326485e-02, -1.135528738224172e-02, -1.129612823600358e-02, -1.123696954931586e-02, -1.117781132701921e-02, -1.111865357403115e-02, -1.105949629534769e-02, -1.100033949604498e-02, -1.094118318128108e-02, -1.088202735629770e-02, -1.082287202642201e-02, -1.076371719706855e-02, -1.070456287374110e-02, -1.064540906203468e-02, -1.058625576763757e-02, -1.052710299633340e-02, -1.046795075400327e-02, -1.040879904662801e-02, -1.034964788029034e-02, -1.029049726117732e-02, -1.023134719558266e-02, -1.017219768990922e-02, -1.011304875067155e-02, -1.005390038449848e-02, -9.994752598135849e-03, -9.935605398449215e-03, -9.876458792426750e-03, -9.817312787182165e-03, -9.758167389957727e-03, -9.699022608127373e-03, -9.639878449199930e-03, -9.580734920822415e-03, -9.521592030783448e-03, -9.462449787016769e-03, -9.403308197604866e-03, -9.344167270782707e-03, -9.285027014941610e-03, -9.225887438633213e-03, -9.166748550573591e-03, -9.107610359647494e-03, -9.048472874912722e-03, -8.989336105604651e-03, -8.930200061140901e-03, -8.871064751126159e-03, -8.811930185357170e-03, -8.752796373827884e-03, -8.693663326734779e-03, -8.634531054482381e-03, -8.575399567688944e-03, -8.516268877192349e-03, -8.457138994056205e-03, -8.398009929576147e-03, -8.338881695286371e-03, -8.279754302966402e-03, -8.220627764648096e-03, -8.161502092622877e-03, -8.102377299449286e-03, -8.043253397960739e-03, -7.984130401273631e-03, -7.925008322795699e-03, -7.865887176234711e-03, -7.806766975607483e-03, -7.747647735249234e-03, -7.688529469823296e-03, -7.629412194331204e-03, -7.570295924123160e-03, -7.511180674908934e-03, -7.452066462769157e-03, -7.392953304167093e-03, -7.333841215960865e-03, -7.274730215416173e-03, -7.215620320219539e-03, -7.156511548492081e-03, -7.097403918803856e-03, -7.038297450188819e-03, -6.979192162160381e-03, -6.920088074727644e-03, -6.860985208412320e-03, -6.801883584266386e-03, -6.742783223890497e-03, -6.683684149453205e-03, -6.624586383711035e-03, -6.565489950029446e-03, -6.506394872404742e-03, -6.447301175486962e-03, -6.388208884603844e-03, -6.329118025785872e-03, -6.270028625792490e-03, -6.210940712139581e-03, -6.151854313128206e-03, -6.092769457874757e-03, -6.033686176342552e-03, -5.974604499374987e-03, -5.915524458730303e-03, -5.856446087118119e-03, -5.797369418237774e-03, -5.738294486818639e-03, -5.679221328662495e-03, -5.620149980688111e-03, -5.561080480978161e-03, -5.502012868828632e-03, -5.442947184800876e-03, -5.383883470776486e-03, -5.324821770015174e-03, -5.265762127215855e-03, -5.206704588581153e-03, -5.147649201885558e-03, -5.088596016547480e-03, -5.029545083705490e-03, -4.970496456299021e-03, -4.911450189153847e-03, -4.852406339072715e-03, -4.793364964931455e-03, -4.734326127781010e-03, -4.675289890955826e-03, -4.616256320189057e-03, -4.557225483735124e-03, -4.498197452500219e-03, -4.439172300181324e-03, -4.380150103414481e-03, -4.321130941933017e-03, -4.262114898736559e-03, -4.203102060271728e-03, -4.144092516625493e-03, -4.085086361732263e-03, -4.026083693595902e-03, -3.967084614527981e-03, -3.908089231403714e-03, -3.849097655937163e-03, -3.790110004977489e-03, -3.731126400828205e-03, -3.672146971591618e-03, -3.613171851540848e-03, -3.554201181522160e-03, -3.495235109390582e-03, -3.436273790482187e-03, -3.377317388126790e-03, -3.318366074205292e-03, -3.259420029756404e-03, -3.200479445638095e-03, -3.141544523249785e-03, -3.082615475322107e-03, -3.023692526781954e-03, -2.964775915701584e-03, -2.905865894341755e-03, -2.846962730300320e-03, -2.788066707779276e-03, -2.729178128985263e-03, -2.670297315680702e-03, -2.611424610905408e-03, -2.552560380891686e-03, -2.493705017199510e-03, -2.434858939102870e-03, -2.376022596263486e-03, -2.317196471734473e-03, -2.258381085343879e-03, -2.199576997517278e-03, -2.140784813609410e-03, -2.082005188828377e-03, -2.023238833852237e-03, -1.964486521258027e-03, -1.905749092908186e-03, -1.847027468470459e-03, -1.788322655286233e-03, -1.729635759851281e-03, -1.670968001235199e-03, -1.612320726845270e-03, -1.553695431043082e-03, -1.495093777255311e-03, -1.436517624394544e-03, -1.377969058636869e-03, -1.319450431911309e-03, -1.260964408872738e-03, -1.202514024699375e-03, -1.144102756843803e-03, -1.085734614972204e-03, -1.027414254901067e-03, -9.691471246200109e-04, -9.109396538477410e-04, -8.527995036155746e-04, -7.947360716299297e-04, -7.367603146470381e-04, -6.788862702024561e-04, -6.211313963844298e-04, -5.635180173390563e-04, -5.060752987088925e-04, -4.488423288973900e-04, -3.918731349811499e-04, -3.352452818750655e-04, -2.790755892322029e-04, -2.235512856526144e-04, -1.689986667236129e-04, -1.160577182851893e-04, -6.622508182274791e-05, -2.400589539874065e-05, -2.528078232476459e-06, -8.555014827186400e-08, -1.108449176411413e-19, 0.000000000000000e+00, 8.555014827714783e-08, 2.528076102867994e-06, 2.400590034672482e-05, 6.622501661691867e-05, 1.160577729537621e-04, 1.689986839003764e-04, 2.235511528523074e-04, 2.790755710097065e-04, 3.352452783056253e-04, 3.918731340808413e-04, 4.488423286243828e-04, 5.060752986133618e-04, 5.635180173014613e-04, 6.211313963680285e-04, 6.788862701945531e-04, 7.367603146428036e-04, 7.947360716274157e-04, 8.527996364065337e-04, 9.109397582322110e-04, 9.691470751813687e-04, 1.027414216783936e-03, 1.085734586326601e-03, 1.144102734680307e-03, 1.202514007331655e-03, 1.260964395110058e-03, 1.319450420892878e-03, 1.377969049732184e-03, 1.436517617135658e-03, 1.495093771290699e-03, 1.553695426105703e-03, 1.612320722730153e-03, 1.670967997783503e-03, 1.729635756938807e-03, 1.788322652815064e-03, 1.847027466362788e-03, 1.905749091101737e-03, 1.964486519702620e-03, 2.023238832507167e-03, 2.082005187660434e-03, 2.140784812591335e-03, 2.199576996626582e-03, 2.258381084561909e-03, 2.317196471045686e-03, 2.376022595654870e-03, 2.434858938563477e-03, 2.493705016720104e-03, 2.552560380464428e-03, 2.611424610523633e-03, 2.670297315338718e-03, 2.729178128678191e-03, 2.788066707502918e-03, 2.846962730051056e-03, 2.905865894116454e-03, 2.964775915497528e-03, 3.023692526596777e-03, 3.082615475153746e-03, 3.141544523096434e-03, 3.200479445498173e-03, 3.259420029628517e-03, 3.318366074088212e-03, 3.377317388019435e-03, 3.436273790383598e-03, 3.495235109299910e-03, 3.554201181438648e-03, 3.613171851463822e-03, 3.672146971520480e-03, 3.731126400762418e-03, 3.790110004916571e-03, 3.849097655880685e-03, 3.908089231351289e-03, 3.967084614479259e-03, 4.026083693550570e-03, 4.085086361690039e-03, 4.144092516586120e-03, 4.203102060234974e-03, 4.262114898702215e-03, 4.321130941900892e-03, 4.380150103384400e-03, 4.439172300153130e-03, 4.498197452473767e-03, 4.557225483710286e-03, 4.616256320165712e-03, 4.675289890933865e-03, 4.734326127760331e-03, 4.793364964911966e-03, 4.852406339054334e-03, 4.911450189136495e-03, 4.970496456282626e-03, 5.029545083689990e-03, 5.088596016532811e-03, 5.147649201871666e-03, 5.206704588567986e-03, 5.265762127203366e-03, 5.324821770003318e-03, 5.383883470765224e-03, 5.442947184790169e-03, 5.502012868818447e-03, 5.561080480968464e-03, 5.620149980678873e-03, 5.679221328653688e-03, 5.738294486810236e-03, 5.797369418229751e-03, 5.856446087110456e-03, 5.915524458722976e-03, 5.974604499367978e-03, 6.033686176335843e-03, 6.092769457868330e-03, 6.151854313122046e-03, 6.210940712133672e-03, 6.270028625786820e-03, 6.329118025780425e-03, 6.388208884598612e-03, 6.447301175481932e-03, 6.506394872399900e-03, 6.565489950024787e-03, 6.624586383706546e-03, 6.683684149448878e-03, 6.742783223886324e-03, 6.801883584262358e-03, 6.860985208408431e-03, 6.920088074723886e-03, 6.979192162156749e-03, 7.038297450185307e-03, 7.097403918800457e-03, 7.156511548488789e-03, 7.215620320216350e-03, 7.274730215413082e-03, 7.333841215957865e-03, 7.392953304164184e-03, 7.452066462766332e-03, 7.511180674906190e-03, 7.570295924120493e-03, 7.629412194328608e-03, 7.688529469820771e-03, 7.747647735246776e-03, 7.806766975605089e-03, 7.865887176232378e-03, 7.925008322793425e-03, 7.984130401271413e-03, 8.043253397958573e-03, 8.102377299447171e-03, 8.161502092620813e-03, 8.220627764646077e-03, 8.279754302964430e-03, 8.338881695284441e-03, 8.398009929574258e-03, 8.457138994054356e-03, 8.516268877190539e-03, 8.575399567687167e-03, 8.634531054480641e-03, 8.693663326733072e-03, 8.752796373826208e-03, 8.811930185355525e-03, 8.871064751124544e-03, 8.930200061139315e-03, 8.989336105603093e-03, 9.048472874911190e-03, 9.107610359645989e-03, 9.166748550572109e-03, 9.225887438631755e-03, 9.285027014940172e-03, 9.344167270781292e-03, 9.403308197603473e-03, 9.462449787015397e-03, 9.521592030782094e-03, 9.580734920821080e-03, 9.639878449198613e-03, 9.699022608126074e-03, 9.758167389956444e-03, 9.817312787180899e-03, 9.876458792425500e-03, 9.935605398447978e-03, 9.994752598134628e-03, 1.005390038449728e-02, 1.011304875067036e-02, 1.017219768990804e-02, 1.023134719558149e-02, 1.029049726117616e-02, 1.034964788028920e-02, 1.040879904662687e-02, 1.046795075400215e-02, 1.052710299633229e-02, 1.058625576763647e-02, 1.064540906203359e-02, 1.070456287374002e-02, 1.076371719706748e-02, 1.082287202642095e-02, 1.088202735629664e-02, 1.094118318128004e-02, 1.100033949604394e-02, 1.105949629534666e-02, 1.111865357403013e-02, 1.117781132701819e-02, 1.123696954931485e-02, 1.129612823600258e-02, 1.135528738224073e-02, 1.141444698326387e-02, 1.147360703438031e-02, 1.153276753097053e-02, 1.159192846848576e-02, 1.165108984244648e-02, 1.171025164844108e-02, 1.176941388212447e-02, 1.182857653921674e-02, 1.188773961550188e-02, 1.194690310682651e-02, 1.200606700909865e-02, 1.206523131828651e-02, 1.212439603041729e-02, 1.218356114157611e-02, 1.224272664790481e-02, 1.230189254560089e-02, 1.236105883091646e-02, 1.242022550015718e-02, 1.247939254968126e-02, 1.253855997589845e-02, 1.259772777526908e-02, 1.265689594430313e-02, 1.271606447955928e-02, 1.277523337764403e-02, 1.283440263521080e-02, 1.289357224895908e-02, 1.295274221563361e-02, 1.301191253202350e-02, 1.307108319496148e-02, 1.313025420132309e-02, 1.318942554802593e-02, 1.324859723202888e-02, 1.330776925033140e-02, 1.336694159997276e-02, 1.342611427803143e-02, 1.348528728162427e-02, 1.354446060790598e-02, 1.360363425406835e-02, 1.366280821733967e-02, 1.372198249498409e-02, 1.378115708430097e-02, 1.384033198262435e-02, 1.389950718732228e-02, 1.395868269579630e-02, 1.401785850548084e-02, 1.407703461384271e-02, 1.413621101838049e-02, 1.419538771662408e-02, 1.425456470613412e-02, 1.431374198450149e-02, 1.437291954934686e-02, 1.443209739832014e-02, 1.449127552910003e-02, 1.455045393939355e-02, 1.460963262693561e-02, 1.466881158948849e-02, 1.472799082484147e-02, 1.478717033081037e-02, 1.484635010523710e-02, 1.490553014598930e-02, 1.496471045095991e-02, 1.502389101806675e-02, 1.508307184525215e-02, 1.514225293048257e-02, 1.520143427174822e-02, 1.526061586706269e-02, 1.531979771446257e-02, 1.537897981200714e-02, 1.543816215777800e-02, 1.549734474987870e-02, 1.555652758643446e-02, 1.561571066559179e-02, 1.567489398551822e-02, 1.573407754440194e-02, 1.579326134045150e-02, 1.585244537189553e-02, 1.591162963698242e-02, 1.597081413398002e-02, 1.602999886117539e-02, 1.608918381687446e-02, 1.614836899940181e-02, 1.620755440710037e-02, 1.626674003833113e-02, 1.632592589147295e-02, 1.638511196492221e-02, 1.644429825709263e-02, 1.650348476641500e-02, 1.656267149133691e-02, 1.662185843032255e-02, 1.668104558185245e-02, 1.674023294442326e-02, 1.679942051654751e-02, 1.685860829675340e-02, 1.691779628358459e-02, 1.697698447559993e-02, 1.703617287137335e-02, 1.709536146949354e-02, 1.715455026856382e-02, 1.721373926720191e-02, 1.727292846403975e-02, 1.733211785772329e-02, 1.739130744691228e-02, 1.745049723028015e-02, 1.750968720651375e-02, 1.756887737431321e-02, 1.762806773239175e-02, 1.768725827947552e-02, 1.774644901430341e-02, 1.780563993562688e-02, 1.786483104220980e-02, 1.792402233282829e-02, 1.798321380627054e-02, 1.804240546133670e-02, 1.810159729683866e-02, 1.816078931159993e-02, 1.821998150445549e-02, 1.827917387425165e-02, 1.833836641984586e-02, 1.839755914010662e-02, 1.845675203391332e-02, 1.851594510015609e-02, 1.857513833773565e-02, 1.863433174556324e-02, 1.869352532256039e-02, 1.875271906765888e-02, 1.881191297980055e-02, 1.887110705793722e-02, 1.893030130103053e-02, 1.898949570805182e-02, 1.904869027798203e-02, 1.910788500981158e-02, 1.916707990254022e-02, 1.922627495517695e-02, 1.928547016673990e-02, 1.934466553625621e-02, 1.940386106276192e-02, 1.946305674530185e-02, 1.952225258292956e-02, 1.958144857470713e-02, 1.964064471970516e-02, 1.969984101700260e-02, 1.975903746568672e-02, 1.981823406485292e-02, 1.987743081360471e-02, 1.993662771105357e-02, 1.999582475631890e-02, 2.005502194852785e-02, 2.011421928681533e-02, 2.017341677032382e-02, 2.023261439820334e-02, 2.029181216961137e-02, 2.035101008371272e-02, 2.041020813967946e-02, 2.046940633669087e-02, 2.052860467393330e-02, 2.058780315060015e-02, 2.064700176589171e-02, 2.070620051901519e-02, 2.076539940918454e-02, 2.082459843562041e-02, 2.088379759755010e-02, 2.094299689420744e-02, 2.100219632483277e-02, 2.106139588867280e-02, 2.112059558498059e-02, 2.117979541301546e-02, 2.123899537204294e-02, 2.129819546133465e-02, 2.135739568016830e-02, 2.141659602782757e-02, 2.147579650360208e-02, 2.153499710678727e-02, 2.159419783668443e-02, 2.165339869260053e-02, 2.171259967384825e-02, 2.177180077974585e-02, 2.183100200961714e-02, 2.189020336279142e-02, 2.194940483860342e-02, 2.200860643639322e-02, 2.206780815550625e-02, 2.212700999529315e-02, 2.218621195510977e-02, 2.224541403431713e-02, 2.230461623228130e-02, 2.236381854837341e-02, 2.242302098196956e-02, 2.248222353245078e-02, 2.254142619920298e-02, 2.260062898161689e-02, 2.265983187908801e-02, 2.271903489101659e-02, 2.277823801680752e-02, 2.283744125587036e-02, 2.289664460761921e-02, 2.295584807147273e-02, 2.301505164685405e-02, 2.307425533319076e-02, 2.313345912991481e-02, 2.319266303646254e-02, 2.325186705227456e-02, 2.331107117679578e-02, 2.337027540947528e-02, 2.342947974976637e-02, 2.348868419712645e-02, 2.354788875101703e-02, 2.360709341090368e-02, 2.366629817625596e-02, 2.372550304654741e-02, 2.378470802125552e-02, 2.384391309986164e-02, 2.390311828185100e-02, 2.396232356671263e-02, 2.402152895393932e-02, 2.408073444302766e-02, 2.413994003347789e-02, 2.419914572479393e-02, 2.425835151648334e-02, 2.431755740805728e-02, 2.437676339903046e-02, 2.443596948892112e-02, 2.449517567725101e-02, 2.455438196354531e-02, 2.461358834733264e-02, 2.467279482814502e-02, 2.473200140551783e-02, 2.479120807898976e-02, 2.485041484810284e-02, 2.490962171240230e-02, 2.496882867143667e-02, 2.502803572475764e-02, 2.508724287192009e-02, 2.514645011248205e-02, 2.520565744600466e-02, 2.526486487205213e-02, 2.532407239019175e-02, 2.538327999999383e-02, 2.544248770103167e-02, 2.550169549288155e-02, 2.556090337512269e-02, 2.562011134733724e-02, 2.567931940911022e-02, 2.573852756002953e-02, 2.579773579968590e-02, 2.585694412767287e-02, 2.591615254358676e-02, 2.597536104702668e-02, 2.603456963759445e-02, 2.609377831489459e-02, 2.615298707853433e-02, 2.621219592812354e-02, 2.627140486327476e-02, 2.633061388360311e-02, 2.638982298872631e-02, 2.644903217826465e-02, 2.650824145184098e-02, 2.656745080908064e-02, 2.662666024961149e-02, 2.668586977306387e-02, 2.674507937907055e-02, 2.680428906726677e-02, 2.686349883729016e-02, 2.692270868878073e-02, 2.698191862138089e-02, 2.704112863473537e-02, 2.710033872849125e-02, 2.715954890229790e-02, 2.721875915580699e-02, 2.727796948867245e-02, 2.733717990055048e-02, 2.739639039109948e-02, 2.745560095998007e-02, 2.751481160685508e-02, 2.757402233138948e-02, 2.763323313325041e-02, 2.769244401210715e-02, 2.775165496763109e-02, 2.781086599949572e-02, 2.787007710737661e-02, 2.792928829095139e-02, 2.798849954989974e-02, 2.804771088390337e-02, 2.810692229264601e-02, 2.816613377581336e-02, 2.822534533309313e-02, 2.828455696417495e-02, 2.834376866875044e-02, 2.840298044651311e-02, 2.846219229715842e-02, 2.852140422038369e-02, 2.858061621588814e-02, 2.863982828337286e-02, 2.869904042254078e-02, 2.875825263309667e-02, 2.881746491474711e-02, 2.887667726720050e-02, 2.893588969016703e-02, 2.899510218335865e-02, 2.905431474648907e-02, 2.911352737927378e-02, 2.917274008142995e-02, 2.923195285267653e-02, 2.929116569273411e-02, 2.935037860132576e-02 };
    this->p.resize(this->x.size());
}

void Stage3::processBlock(juce::AudioBuffer<float>& buffer) {

    int channelNumber = buffer.getNumChannels();
    float array[4] = { 0,0,0,0 };
    this->w.resize(channelNumber, std::array<float, 4>{0});
    this->yBuffer.resize(channelNumber, 0.f);
    this->uBuffer.resize(channelNumber, 0.f);

    std::array<float, 4> pk{ 0 };
    float p;

    for (int channel = 0; channel < channelNumber; channel++) {
        auto channelSamples = buffer.getWritePointer(channel);
        for (int i = 0; i < buffer.getNumSamples(); i++) {
            float chnTmp = channelSamples[i];

            std::array<float, 4> Hw = matrixMul(H, w[channel]);
            std::array<float, 4> Ju = matrixMul(J, chnTmp + uBuffer[channel]);
            std::array<float, 4> Gy = matrixMul(G, yBuffer[channel]);

            pk = matrixAdd(matrixAdd(Hw, Ju), Gy);

            p = matrixMul(D, pk) + E * chnTmp;
            this->yBuffer[channel] = closestElementLinearInterpolate(p, this->p, this->y);
            
            Gy = matrixMul(G, yBuffer[channel]);
            w[channel] = matrixAdd(Gy, pk);
            this->uBuffer[channel] = chnTmp;
            channelSamples[i] = w[channel][1] + w[channel][3] + channelSamples[i] - R35 * yBuffer[channel];
        }
    }

}
