#include "Stage4.h"
#include <cmath>

void Stage4::processBlock(juce::AudioBuffer<float>& buffer) {
    //y[k]=Ay[k-1]+By[k-2]+Cy[k-3]+Dy[k-4]+Eu[k]+Fu[k-1]...
    int channelNumber = buffer.getNumChannels();
    this->yBuffer.resize(channelNumber, CircularBuffer<float, 4>{0.0f});
    this->uBuffer.resize(channelNumber, CircularBuffer<float, 4>{0.0f});


    //y[k]=Ay[k-1]+By[k-2]+Cy[k-3]+Dy[k-4]+Eu[k]+Fu[k-1]...
    for (int channel = 0; channel < channelNumber; channel++) {
        auto channelSamples = buffer.getWritePointer(channel);
        for (int i = 0; i < buffer.getNumSamples(); i++) {
            float tmp = channelSamples[i];
            float test= this->A * this->yBuffer[channel][0] + this->B * this->yBuffer[channel][1] + this->C * this->yBuffer[channel][2] + this->D * this->yBuffer[channel][3] + this->E * channelSamples[i] + this->F * this->uBuffer[channel][0] + this->G * this->uBuffer[channel][1] + this->H * this->uBuffer[channel][2] + this->I * this->uBuffer[channel][3];
            if (test != test || isinf(test) || test>10 || test<-10) {
                jassertfalse;
            }
            channelSamples[i] = this->A * this->yBuffer[channel][0] + this->B * this->yBuffer[channel][1] + this->C * this->yBuffer[channel][2] + this->D * this->yBuffer[channel][3] + this->E * channelSamples[i] + this->F * this->uBuffer[channel][0] + this->G * this->uBuffer[channel][1] + this->H * this->uBuffer[channel][2] + this->I * this->uBuffer[channel][3];
            

            this->yBuffer[channel].push(channelSamples[i]);
            //this->yBuffer[channel][3] = this->yBuffer[channel][2];
            //this->yBuffer[channel][2] = this->yBuffer[channel][1];
            //this->yBuffer[channel][1] = this->yBuffer[channel][0];
            //this->yBuffer[channel][0] = channelSamples[i];
            
            this->uBuffer[channel].push(tmp);
            //this->uBuffer[channel][3] = this->uBuffer[channel][2];
            //this->uBuffer[channel][2] = this->uBuffer[channel][1];
            //this->uBuffer[channel][1] = this->uBuffer[channel][0];
            //this->uBuffer[channel][0] = tmp;
        }
    }
}

void Stage4::configure(double sampleRate) {

    this->sampleRate = static_cast<float>(sampleRate);
    double T = 1 / sampleRate;
    double B = static_cast<double>(*this->bassParameter);
    double M = static_cast<double>(*this->midParameter);
    double TR2 = static_cast<double>(*this->trebleParameter);
    double TR1 = 250000.0 + 0.01 - TR2;

    double G = 1 / ((533.803148049091980882120328544040347976403257171 * B) / 2156795733372051183573361.206961570453890971553803245798488288819937280 + (0.00006274825849828609 * T) / 25353012004.56458802993406410752 + (0.000001726535807035033197328125 * M * T) / 696898287454.081973172991196020261297061888 + (0.000000000000417274442583990799 * T * TR1) / 166153.499473114484112975882535043072 + (0.000000000001670742678283540667 * T * TR2) / 664613.997892457936451903530140172288 + (8.311478524666663169915429011011667535841530076396790734055467 * B * T * T) / 84249833334845.749358334422146936345855116076320439289003448782028800000000 + (0.000041526407829211405506621249979618093590247 * B * T * T * T) / 45671926.166590716193865151022383844364247891968000000 + (0.000002876968547602381393300375 * M * T * T) / 21267647.932558653966460912964485513216 + (0.0000044889515712632369795 * M * T * T * T) / 4056481.9207303340847894502572032 + (0.000000000008907027864639130449 * T * T * TR1) / 41538.374868278621028243970633760768 + (0.0000123013093165950040607 * T * T * TR2) / 2076918743.4139310514121985316880384 + (0.0000000163778023660334793 * T * T * T * TR1) / 16225927.6829213363391578010288128 + (0.0000074615473641083918805 * T * T * T * TR2) / 16225927.6829213363391578010288128 + (0.56533735394714965953 * T * T) / 99035203.14283042199192993792 + (12.06709734821125355701 * T * T * T) / 24758800.78570760549798248448 + (0.88753337404040790093 * T * T * T * T) / 386856.26227668133590597632 + (0.00000000000000210670131504873518714752587925352439739887833231487 * B * M) / 18092513943.33065553493296640760748560207343510400633813116524750123642650624 + (0.000772835371751105509466483201611550253690231965608886373699 * B * T) / 1347997333357.531989733350754350981533681857221127028624055180512460800000 + (0.00000000000000002166612777375726275345076627619928471198342632047 * B * TR1) / 86271829.33488204734293444827846281815563886215212983193953155279749120000 + (0.00000000000000542186997491980660817151277233526158147562061268921 * B * TR2) / 21567957333.72051183573361206961570453890971553803245798488288819937280000000 + (0.0000000000151225952988341954994003693771715669011233696798888086076331 * B * M * T) / 1766847064.7783843295832975007429185158274838968756189581216062012926197760000000 + (0.0000000000000000016996626954833071005686756377081174575400777235392419 * B * M * TR1) / 452312848583.2663883733241601901871400518358776001584532791311875309106626560000000 + (0.0000000000000000000031431585364537710168411908757210846372022332966363 * B * M * TR2) / 862718293.3488204734293444827846281815563886215212983193953155279749120000000000 + (0.00000000000233550075354925391503173537230853462857826378248244977 * B * T * TR1) / 53919893334.30127958933403017403926134727428884508114496220722049843200000000 + (0.00000000412261973553721864922886160732134110648775511249713114767 * B * T * TR2) / 6739986666787.65994866675377175490766840928610563514312027590256230400000000000 + (0.0000000000000000000002166612777375726275345076627619928471198342632047 * B * TR1 * TR2) / 862718293.3488204734293444827846281815563886215212983193953155279749120000000000 + (0.00000000000001325328363144135256625 * M * T * TR1) / 223007451.98530623141535718272648361505980416 + (0.000000002541184116487107216125 * M * T * TR2) / 44601490397061.246283071436545296723011960832 + (0.000000000000437543965906950729 * T * TR1 * TR2) / 174224571863.520493293247799005065324265472 + (0.00000000011282566214941741196331206316836313917420183274501223107 * B * M * T * T) / 1347997333.35753198973335075435098153368185722112702862405518051246080000000 + (0.000000000005840277462905274569697905814833869 * B * T * T * TR1) / 14615016373.309029182036848327162830196559325429760000000 + (0.00000000102860640519897919097970773989424905323139 * B * T * T * TR2) / 11417981541.64767904846628775559596109106197299200000000000000 + (0.000000000000331070242683654831 * M * T * T * TR1) / 680564733.841876926926749214863536422912 + (0.000000000176480682067831445985 * M * T * T * TR2) / 1361129467.683753853853498429727072845824 + (0.000000000000137386963950127383 * T * T * TR1 * TR2) / 680564733.841876926926749214863536422912 + (0.000000000000158677981241598398251827782077795050627608578479 * B * M * T * TR1) / 4313591466744102.367146722413923140907781943107606491596976577639874560000000 + (0.0000000000000005588140199799516595213120320811324062825952139834602179 * B * M * T * TR2) / 67399866667.8765994866675377175490766840928610563514312027590256230400000000000000 + (0.0000000000000000000000031400185179358351816595313443767079292729603363 * B * M * TR1 * TR2) / 862718293348.8204734293444827846281815563886215212983193953155279749120000000000000 + (0.00000000000000002889914877592634211337934095020143 * B * T * TR1 * TR2) / 730750818665.45145910184241635814150982796627148800000000000000 + (0.00000000000000000020309163768128729 * M * T * TR1 * TR2) / 3568119231.76489970264571492362373784095686656);
    this->A =  - ((0.000041526407829211405506621249979618093590247 * B * T * T * T) / 22835963.083295358096932575511191922182123945984000000 - (0.0000000006274825849828609 * T) / 126765.0600228229401496703205376 - (0.00000000001726535807035033197328125 * M * T) / 3484491.43727040986586495598010130648530944 - (0.0000000417274442583990799 * T * TR1) / 8307674973.6557242056487941267521536 - (0.0000001670742678283540667 * T * TR2) / 33230699894.6228968225951765070086144 - (0.000000000000533803148049091980882120328544040347976403257171 * B) / 539198933.343012795893340301740392613472742888450811449622072204984320 + (0.0000044889515712632369795 * M * T * T * T) / 2028240.9603651670423947251286016 + (0.0000000163778023660334793 * T * T * T * TR1) / 8112963.8414606681695789005144064 + (0.0000074615473641083918805 * T * T * T * TR2) / 8112963.8414606681695789005144064 + (12.06709734821125355701 * T * T * T) / 12379400.39285380274899124224 + (88753.337404040790093 * T * T * T * T) / 9671406556.917033397649408 - (0.00000000000000210670131504873518714752587925352439739887833231487 * B * M) / 4523128485.83266388373324160190187140051835877600158453279131187530910662656 - (0.00000000772835371751105509466483201611550253690231965608886373699 * B * T) / 6739986.66678765994866675377175490766840928610563514312027590256230400000 - (0.00000000000000002166612777375726275345076627619928471198342632047 * B * TR1) / 21567957.33372051183573361206961570453890971553803245798488288819937280000 - (0.00000000000000542186997491980660817151277233526158147562061268921 * B * TR2) / 5391989333.43012795893340301740392613472742888450811449622072204984320000000 - (0.0000000000151225952988341954994003693771715669011233696798888086076331 * B * M * T) / 883423532.3891921647916487503714592579137419484378094790608031006463098880000000 - (0.000000000000000000000016996626954833071005686756377081174575400777235392419 * B * M * TR1) / 1130782.121458165970933310400475467850129589694000396133197827968827276656640000000 - (0.0000000000000000000031431585364537710168411908757210846372022332966363 * B * M * TR2) / 215679573.3372051183573361206961570453890971553803245798488288819937280000000000 - (0.00000000000233550075354925391503173537230853462857826378248244977 * B * T * TR1) / 26959946667.15063979466701508701963067363714442254057248110361024921600000000 - (0.0000000000000412261973553721864922886160732134110648775511249713114767 * B * T * TR2) / 33699933.3339382997433337688587745383420464305281757156013795128115200000000000 - (0.0000000000000000000002166612777375726275345076627619928471198342632047 * B * TR1 * TR2) / 215679573.3372051183573361206961570453890971553803245798488288819937280000000000 - (0.00000000000001325328363144135256625 * M * T * TR1) / 111503725.99265311570767859136324180752990208 - (0.00000000000002541184116487107216125 * M * T * TR2) / 223007451.98530623141535718272648361505980416 - (0.000000000000437543965906950729 * T * TR1 * TR2) / 87112285931.760246646623899502532662132736 - (0.00000000000000000158677981241598398251827782077795050627608578479 * B * M * T * TR1) / 21567957333.72051183573361206961570453890971553803245798488288819937280000000 - (0.0000000000000005588140199799516595213120320811324062825952139834602179 * B * M * T * TR2) / 33699933333.9382997433337688587745383420464305281757156013795128115200000000000000 - (0.000000000000000000000000000031400185179358351816595313443767079292729603363 * B * M * TR1 * TR2) / 2156795.733372051183573361206961570453890971553803245798488288819937280000000000000 - (0.0000000000000000000002889914877592634211337934095020143 * B * T * TR1 * TR2) / 3653754.0933272572955092120817907075491398313574400000000000000 - (0.00000000000000000020309163768128729 * M * T * TR1 * TR2) / 1784059615.88244985132285746181186892047843328) * G;
    this->B =  - ((0.000000000001601409444147275942646360985632121043929209771513 * B) / 1078397866.686025591786680603480785226945485776901622899244144409968640 - (0.00008311478524666663169915429011011667535841530076396790734055467 * B * T * T) / 421249166.67422874679167211073468172927558038160219644501724391014400000000 - (0.000002876968547602381393300375 * M * T * T) / 10633823.966279326983230456482242756608 - (0.0000008907027864639130449 * T * T * TR1) / 2076918743.4139310514121985316880384 - (0.0000123013093165950040607 * T * T * TR2) / 1038459371.7069655257060992658440192 - (0.56533735394714965953 * T * T) / 49517601.57141521099596496896 + (33282.501526515296221 * T * T * T * T) / 2417851639.229258349412352 + (0.00000000000000632010394514620556144257763776057319219663499694461 * B * M) / 9046256971.66532776746648320380374280103671755200316906558262375061821325312 + (0.00000000000000006499838332127178826035229882859785413595027896141 * B * TR1) / 43135914.66744102367146722413923140907781943107606491596976577639874560000 + (0.00000000000001626560992475941982451453831700578474442686183806763 * B * TR2) / 10783978666.86025591786680603480785226945485776901622899244144409968640000000 + (0.0000000000000000050989880864499213017060269131243523726202331706177257 * B * M * TR1) / 226156424291.6331941866620800950935700259179388000792266395655937654553313280000000 + (0.0000000000000000000094294756093613130505235726271632539116066998899089 * B * M * TR2) / 431359146.6744102367146722413923140907781943107606491596976577639874560000000000 + (0.0000000000000000000006499838332127178826035229882859785413595027896141 * B * TR1 * TR2) / 431359146.6744102367146722413923140907781943107606491596976577639874560000000000 - (0.00000000011282566214941741196331206316836313917420183274501223107 * B * M * T * T) / 673998666.67876599486667537717549076684092861056351431202759025623040000000 - (0.000000000005840277462905274569697905814833869 * B * T * T * TR1) / 7307508186.654514591018424163581415098279662714880000000 - (0.00000000102860640519897919097970773989424905323139 * B * T * T * TR2) / 5708990770.82383952423314387779798054553098649600000000000000 - (0.000000000000331070242683654831 * M * T * T * TR1) / 340282366.920938463463374607431768211456 - (0.000000000176480682067831445985 * M * T * T * TR2) / 680564733.841876926926749214863536422912 - (0.000000000000137386963950127383 * T * T * TR1 * TR2) / 340282366.920938463463374607431768211456 + (0.0000000000000000000000094200555538075055449785940331301237878188810089 * B * M * TR1 * TR2) / 431359146674.4102367146722413923140907781943107606491596976577639874560000000000000) * G;
    this->C =  - ((0.0000000006274825849828609 * T) / 126765.0600228229401496703205376 - (0.000000000000533803148049091980882120328544040347976403257171 * B) / 539198933.343012795893340301740392613472742888450811449622072204984320 + (0.00000000001726535807035033197328125 * M * T) / 3484491.43727040986586495598010130648530944 + (0.0000000417274442583990799 * T * TR1) / 8307674973.6557242056487941267521536 + (0.0000001670742678283540667 * T * TR2) / 33230699894.6228968225951765070086144 - (0.000041526407829211405506621249979618093590247 * B * T * T * T) / 22835963.083295358096932575511191922182123945984000000 - (0.0000044889515712632369795 * M * T * T * T) / 2028240.9603651670423947251286016 - (0.0000000163778023660334793 * T * T * T * TR1) / 8112963.8414606681695789005144064 - (0.0000074615473641083918805 * T * T * T * TR2) / 8112963.8414606681695789005144064 - (12.06709734821125355701 * T * T * T) / 12379400.39285380274899124224 + (88753.337404040790093 * T * T * T * T) / 9671406556.917033397649408 - (0.00000000000000210670131504873518714752587925352439739887833231487 * B * M) / 4523128485.83266388373324160190187140051835877600158453279131187530910662656 + (0.00000000772835371751105509466483201611550253690231965608886373699 * B * T) / 6739986.66678765994866675377175490766840928610563514312027590256230400000 - (0.00000000000000002166612777375726275345076627619928471198342632047 * B * TR1) / 21567957.33372051183573361206961570453890971553803245798488288819937280000 - (0.00000000000000542186997491980660817151277233526158147562061268921 * B * TR2) / 5391989333.43012795893340301740392613472742888450811449622072204984320000000 + (0.0000000000151225952988341954994003693771715669011233696798888086076331 * B * M * T) / 883423532.3891921647916487503714592579137419484378094790608031006463098880000000 - (0.000000000000000000000016996626954833071005686756377081174575400777235392419 * B * M * TR1) / 1130782.121458165970933310400475467850129589694000396133197827968827276656640000000 - (0.0000000000000000000031431585364537710168411908757210846372022332966363 * B * M * TR2) / 215679573.3372051183573361206961570453890971553803245798488288819937280000000000 + (0.00000000000233550075354925391503173537230853462857826378248244977 * B * T * TR1) / 26959946667.15063979466701508701963067363714442254057248110361024921600000000 + (0.0000000000000412261973553721864922886160732134110648775511249713114767 * B * T * TR2) / 33699933.3339382997433337688587745383420464305281757156013795128115200000000000 - (0.0000000000000000000002166612777375726275345076627619928471198342632047 * B * TR1 * TR2) / 215679573.3372051183573361206961570453890971553803245798488288819937280000000000 + (0.00000000000001325328363144135256625 * M * T * TR1) / 111503725.99265311570767859136324180752990208 + (0.00000000000002541184116487107216125 * M * T * TR2) / 223007451.98530623141535718272648361505980416 + (0.000000000000437543965906950729 * T * TR1 * TR2) / 87112285931.760246646623899502532662132736 + (0.00000000000000000158677981241598398251827782077795050627608578479 * B * M * T * TR1) / 21567957333.72051183573361206961570453890971553803245798488288819937280000000 + (0.0000000000000005588140199799516595213120320811324062825952139834602179 * B * M * T * TR2) / 33699933333.9382997433337688587745383420464305281757156013795128115200000000000000 - (0.000000000000000000000000000031400185179358351816595313443767079292729603363 * B * M * TR1 * TR2) / 2156795.733372051183573361206961570453890971553803245798488288819937280000000000000 + (0.0000000000000000000002889914877592634211337934095020143 * B * T * TR1 * TR2) / 3653754.0933272572955092120817907075491398313574400000000000000 + (0.00000000000000000020309163768128729 * M * T * TR1 * TR2) / 1784059615.88244985132285746181186892047843328) * G;
    this->D =  - ((0.000000000000533803148049091980882120328544040347976403257171 * B) / 2156795733.372051183573361206961570453890971553803245798488288819937280 - (0.00006274825849828609 * T) / 25353012004.56458802993406410752 - (0.00000000001726535807035033197328125 * M * T) / 6968982.87454081973172991196020261297061888 - (0.0000000417274442583990799 * T * TR1) / 16615349947.3114484112975882535043072 - (0.0000001670742678283540667 * T * TR2) / 66461399789.2457936451903530140172288 + (0.00008311478524666663169915429011011667535841530076396790734055467 * B * T * T) / 842498333.34845749358334422146936345855116076320439289003448782028800000000 - (0.000041526407829211405506621249979618093590247 * B * T * T * T) / 45671926.166590716193865151022383844364247891968000000 + (0.000002876968547602381393300375 * M * T * T) / 21267647.932558653966460912964485513216 - (0.0000044889515712632369795 * M * T * T * T) / 4056481.9207303340847894502572032 + (0.0000008907027864639130449 * T * T * TR1) / 4153837486.8278621028243970633760768 + (0.0000123013093165950040607 * T * T * TR2) / 2076918743.4139310514121985316880384 - (0.0000000163778023660334793 * T * T * T * TR1) / 16225927.6829213363391578010288128 - (0.0000074615473641083918805 * T * T * T * TR2) / 16225927.6829213363391578010288128 + (0.56533735394714965953 * T * T) / 99035203.14283042199192993792 - (12.06709734821125355701 * T * T * T) / 24758800.78570760549798248448 + (88753.337404040790093 * T * T * T * T) / 38685626227.668133590597632 + (0.00000000000000210670131504873518714752587925352439739887833231487 * B * M) / 18092513943.33065553493296640760748560207343510400633813116524750123642650624 - (0.00000000772835371751105509466483201611550253690231965608886373699 * B * T) / 13479973.33357531989733350754350981533681857221127028624055180512460800000 + (0.00000000000000002166612777375726275345076627619928471198342632047 * B * TR1) / 86271829.33488204734293444827846281815563886215212983193953155279749120000 + (0.00000000000000542186997491980660817151277233526158147562061268921 * B * TR2) / 21567957333.72051183573361206961570453890971553803245798488288819937280000000 - (0.0000000000151225952988341954994003693771715669011233696798888086076331 * B * M * T) / 1766847064.7783843295832975007429185158274838968756189581216062012926197760000000 + (0.000000000000000000000016996626954833071005686756377081174575400777235392419 * B * M * TR1) / 4523128.485832663883733241601901871400518358776001584532791311875309106626560000000 + (0.0000000000000000000031431585364537710168411908757210846372022332966363 * B * M * TR2) / 862718293.3488204734293444827846281815563886215212983193953155279749120000000000 - (0.00000000000233550075354925391503173537230853462857826378248244977 * B * T * TR1) / 53919893334.30127958933403017403926134727428884508114496220722049843200000000 - (0.0000000000000412261973553721864922886160732134110648775511249713114767 * B * T * TR2) / 67399866.6678765994866675377175490766840928610563514312027590256230400000000000 + (0.0000000000000000000002166612777375726275345076627619928471198342632047 * B * TR1 * TR2) / 862718293.3488204734293444827846281815563886215212983193953155279749120000000000 - (0.00000000000001325328363144135256625 * M * T * TR1) / 223007451.98530623141535718272648361505980416 - (0.00000000000002541184116487107216125 * M * T * TR2) / 446014903.97061246283071436545296723011960832 - (0.00000000000000000437543965906950729 * T * TR1 * TR2) / 1742245.71863520493293247799005065324265472 + (0.00000000011282566214941741196331206316836313917420183274501223107 * B * M * T * T) / 1347997333.35753198973335075435098153368185722112702862405518051246080000000 + (0.000000000005840277462905274569697905814833869 * B * T * T * TR1) / 14615016373.309029182036848327162830196559325429760000000 + (0.00000000102860640519897919097970773989424905323139 * B * T * T * TR2) / 11417981541.64767904846628775559596109106197299200000000000000 + (0.000000000000331070242683654831 * M * T * T * TR1) / 680564733.841876926926749214863536422912 + (0.000000000176480682067831445985 * M * T * T * TR2) / 1361129467.683753853853498429727072845824 + (0.000000000000137386963950127383 * T * T * TR1 * TR2) / 680564733.841876926926749214863536422912 - (0.00000000000000000158677981241598398251827782077795050627608578479 * B * M * T * TR1) / 43135914667.44102367146722413923140907781943107606491596976577639874560000000 - (0.0000000000000005588140199799516595213120320811324062825952139834602179 * B * M * T * TR2) / 67399866667.8765994866675377175490766840928610563514312027590256230400000000000000 + (0.000000000000000000000000000031400185179358351816595313443767079292729603363 * B * M * TR1 * TR2) / 8627182.933488204734293444827846281815563886215212983193953155279749120000000000000 - (0.0000000000000000000002889914877592634211337934095020143 * B * T * TR1 * TR2) / 7307508.1866545145910184241635814150982796627148800000000000000 - (0.00000000000000000020309163768128729 * M * T * TR1 * TR2) / 3568119231.76489970264571492362373784095686656) * G;
    this->E = ((0.000000000007408006819768664144938091315600625 * M * T) / 2993155.353253689176481146537402947624255349848014848 + (0.0000000003617190829965168074776892011073 * T * TR2) / 146150163.7330902918203684832716283019655932542976 + (0.000000157342640139290437216569684823032958709 * B * T * T) / 1784059.615882449851322857461811868920478433280000000 + (0.000000231131345852188573049635502142372958709 * M * T * T) / 1784059.615882449851322857461811868920478433280000000 + (0.0000000004421042452925981350493588234729 * T * T * TR2) / 2283596.3083295358096932575511191922182123945984 + (0.00000000000000026307458979130059779564508981687367599886093060875 * B * M) / 2261564242.91633194186662080095093570025917938800079226639565593765455331328 + (0.000000000066725393506136497610265041068005043497050407146375 * B * T) / 26959946.667150639794667015087019630673637144422540572481103610249216 + (0.00000000000000000533803148049091980882120328544040347976403257171 * B * TR2) / 21567957.33372051183573361206961570453890971553803245798488288819937280000 + (0.00000000001117516533620487983992144207642995468021393563218512423 * B * M * T) / 1347997333.35753198973335075435098153368185722112702862405518051246080000000 + (0.00000000000000000031400185179358351816595313443767079292729603363 * B * M * TR1) / 86271829334.88204734293444827846281815563886215212983193953155279749120000000 + (0.00000000000000000031400185179358351816595313443767079292729603363 * B * M * TR2) / 86271829334.88204734293444827846281815563886215212983193953155279749120000000 + (0.000000000000004421042452925981350493588234729 * B * T * TR1) / 114179815.416476790484662877555959610910619729920000000 + (0.000000000000004421042452925981350493588234729 * B * T * TR2) / 114179815.416476790484662877555959610910619729920000000 + (0.000000000000010903399274152626767439407189101 * M * T * TR1) / 191561942.608236107294793378393788647952342390272950272 + (0.000000000000010903399274152626767439407189101 * M * T * TR2) / 191561942.608236107294793378393788647952342390272950272) * G;
    this->F = ((0.0000000000000000000026707013078215478993 * M * T * T) / 174224571.8635204932932477990050653242654720000000 - (0.0000000003617190829965168074776892011073 * T * TR2) / 73075081.8665451459101842416358141509827966271488 - (0.000000000007408006819768664144938091315600625 * M * T) / 1496577.676626844588240573268701473812127674924007424 - (0.00000000000000026307458979130059779564508981687367599886093060875 * B * M) / 565391060.72908298546665520023773392506479484700019806659891398441363832832 - (0.000000000066725393506136497610265041068005043497050407146375 * B * T) / 13479973.333575319897333507543509815336818572211270286240551805124608 - (0.00000000000000000533803148049091980882120328544040347976403257171 * B * TR2) / 5391989.33343012795893340301740392613472742888450811449622072204984320000 - (0.00000000001117516533620487983992144207642995468021393563218512423 * B * M * T) / 673998666.67876599486667537717549076684092861056351431202759025623040000000 - (0.00000000000000000031400185179358351816595313443767079292729603363 * B * M * TR1) / 21567957333.72051183573361206961570453890971553803245798488288819937280000000 - (0.00000000000000000031400185179358351816595313443767079292729603363 * B * M * TR2) / 21567957333.72051183573361206961570453890971553803245798488288819937280000000 - (0.000000000000004421042452925981350493588234729 * B * T * TR1) / 57089907.708238395242331438777979805455309864960000000 - (0.000000000000004421042452925981350493588234729 * B * T * TR2) / 57089907.708238395242331438777979805455309864960000000 - (0.000000000000010903399274152626767439407189101 * M * T * TR1) / 95780971.304118053647396689196894323976171195136475136 - (0.000000000000010903399274152626767439407189101 * M * T * TR2) / 95780971.304118053647396689196894323976171195136475136) * G;
    this->G = ((0.00000000000000078922376937390179338693526945062102799658279182625 * B * M) / 1130782121.45816597093331040047546785012958969400039613319782796882727665664 - (0.000000231131345852188600397616894235023447541 * M * T * T) / 892029.807941224925661428730905934460239216640000000 - (0.0000000004421042452925981350493588234729 * T * T * TR2) / 1141798.1541647679048466287755595961091061972992 - (0.0157342640139290437216569684823032958709 * B * T * T) / 89202980794.1224925661428730905934460239216640000000 + (0.00000000000000001601409444147275942646360985632121043929209771513 * B * TR2) / 10783978.66686025591786680603480785226945485776901622899244144409968640000 + (0.00000000000000000094200555538075055449785940331301237878188810089 * B * M * TR1) / 43135914667.44102367146722413923140907781943107606491596976577639874560000000 + (0.00000000000000000094200555538075055449785940331301237878188810089 * B * M * TR2) / 43135914667.44102367146722413923140907781943107606491596976577639874560000000) * G;
    this->H = ((0.000000000007408006819768664144938091315600625 * M * T) / 1496577.676626844588240573268701473812127674924007424 + (0.0000000003617190829965168074776892011073 * T * TR2) / 73075081.8665451459101842416358141509827966271488 + (0.0000000000000000000026707013078215478993 * M * T * T) / 174224571.8635204932932477990050653242654720000000 - (0.00000000000000026307458979130059779564508981687367599886093060875 * B * M) / 565391060.72908298546665520023773392506479484700019806659891398441363832832 + (0.000000000066725393506136497610265041068005043497050407146375 * B * T) / 13479973.333575319897333507543509815336818572211270286240551805124608 - (0.00000000000000000533803148049091980882120328544040347976403257171 * B * TR2) / 5391989.33343012795893340301740392613472742888450811449622072204984320000 + (0.00000000001117516533620487983992144207642995468021393563218512423 * B * M * T) / 673998666.67876599486667537717549076684092861056351431202759025623040000000 - (0.00000000000000000031400185179358351816595313443767079292729603363 * B * M * TR1) / 21567957333.72051183573361206961570453890971553803245798488288819937280000000 - (0.00000000000000000031400185179358351816595313443767079292729603363 * B * M * TR2) / 21567957333.72051183573361206961570453890971553803245798488288819937280000000 + (0.000000000000004421042452925981350493588234729 * B * T * TR1) / 57089907.708238395242331438777979805455309864960000000 + (0.000000000000004421042452925981350493588234729 * B * T * TR2) / 57089907.708238395242331438777979805455309864960000000 + (0.000000000000010903399274152626767439407189101 * M * T * TR1) / 95780971.304118053647396689196894323976171195136475136 + (0.000000000000010903399274152626767439407189101 * M * T * TR2) / 95780971.304118053647396689196894323976171195136475136) * G;
    this->I = ((0.000000157342640139290437216569684823032958709 * B * T * T) / 1784059.615882449851322857461811868920478433280000000 - (0.0000000003617190829965168074776892011073 * T * TR2) / 146150163.7330902918203684832716283019655932542976 - (0.000000000007408006819768664144938091315600625 * M * T) / 2993155.353253689176481146537402947624255349848014848 + (0.000000231131345852188573049635502142372958709 * M * T * T) / 1784059.615882449851322857461811868920478433280000000 + (0.0000000004421042452925981350493588234729 * T * T * TR2) / 2283596.3083295358096932575511191922182123945984 + (0.00000000000000026307458979130059779564508981687367599886093060875 * B * M) / 2261564242.91633194186662080095093570025917938800079226639565593765455331328 - (0.000000000066725393506136497610265041068005043497050407146375 * B * T) / 26959946.667150639794667015087019630673637144422540572481103610249216 + (0.00000000000000000533803148049091980882120328544040347976403257171 * B * TR2) / 21567957.33372051183573361206961570453890971553803245798488288819937280000 - (0.00000000001117516533620487983992144207642995468021393563218512423 * B * M * T) / 1347997333.35753198973335075435098153368185722112702862405518051246080000000 + (0.00000000000000000031400185179358351816595313443767079292729603363 * B * M * TR1) / 86271829334.88204734293444827846281815563886215212983193953155279749120000000 + (0.00000000000000000031400185179358351816595313443767079292729603363 * B * M * TR2) / 86271829334.88204734293444827846281815563886215212983193953155279749120000000 - (0.000000000000004421042452925981350493588234729 * B * T * TR1) / 114179815.416476790484662877555959610910619729920000000 - (0.000000000000004421042452925981350493588234729 * B * T * TR2) / 114179815.416476790484662877555959610910619729920000000 - (0.000000000000010903399274152626767439407189101 * M * T * TR1) / 191561942.608236107294793378393788647952342390272950272 - (0.000000000000010903399274152626767439407189101 * M * T * TR2) / 191561942.608236107294793378393788647952342390272950272) * G;

}

void Stage4::initParameters(std::atomic<float>* bassParameter, std::atomic<float>* midParameter, std::atomic<float>* trebleParameter) {
    this->bassParameter = bassParameter;
    this->midParameter = midParameter;
    this->trebleParameter = trebleParameter;
}
