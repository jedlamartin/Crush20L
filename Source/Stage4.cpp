#include "Stage4.h"
#include <cmath>

void Stage4::processBlock(juce::AudioBuffer<float>& buffer) {
    //y[k]=Ay[k-1]+By[k-2]+Cy[k-3]+Dy[k-4]+Eu[k]+Fu[k-1]...
    int channelNumber = buffer.getNumChannels();
    this->yBuffer.resize(channelNumber, std::array<float, 4>{0, 0, 0, 0});
    this->uBuffer.resize(channelNumber, std::array<float, 4>{0, 0, 0, 0});
    //float t[512] = { 0.00283813476562500, 0.00567626953125000, 0.00854492187500000, 0.0113830566406250, 0.0142211914062500, 0.0170898437500000, 0.0199279785156250, 0.0227966308593750, 0.0256347656250000, 0.0284729003906250, 0.0313415527343750, 0.0341796875000000, 0.0370178222656250, 0.0398864746093750, 0.0427246093750000, 0.0455627441406250, 0.0484313964843750, 0.0512695312500000, 0.0541076660156250, 0.0569763183593750, 0.0598144531250000, 0.0626525878906250, 0.0654907226562500, 0.0683593750000000, 0.0711975097656250, 0.0740356445312500, 0.0768737792968750, 0.0797119140625000, 0.0825500488281250, 0.0854187011718750, 0.0882568359375000, 0.0910949707031250, 0.0939331054687500, 0.0967712402343750, 0.0996093750000000, 0.102447509765625, 0.105285644531250, 0.108123779296875, 0.110961914062500, 0.113800048828125, 0.116638183593750, 0.119445800781250, 0.122283935546875, 0.125122070312500, 0.127960205078125, 0.130767822265625, 0.133605957031250, 0.136444091796875, 0.139251708984375, 0.142089843750000, 0.144927978515625, 0.147735595703125, 0.150573730468750, 0.153381347656250, 0.156188964843750, 0.159027099609375, 0.161834716796875, 0.164642333984375, 0.167480468750000, 0.170288085937500, 0.173095703125000, 0.175903320312500, 0.178710937500000, 0.181518554687500, 0.184326171875000, 0.187133789062500, 0.189941406250000, 0.192749023437500, 0.195556640625000, 0.198333740234375, 0.201141357421875, 0.203948974609375, 0.206726074218750, 0.209533691406250, 0.212310791015625, 0.215118408203125, 0.217895507812500, 0.220672607421875, 0.223480224609375, 0.226257324218750, 0.229034423828125, 0.231811523437500, 0.234588623046875, 0.237365722656250, 0.240142822265625, 0.242919921875000, 0.245697021484375, 0.248443603515625, 0.251220703125000, 0.253997802734375, 0.256744384765625, 0.259521484375000, 0.262268066406250, 0.265014648437500, 0.267791748046875, 0.270538330078125, 0.273284912109375, 0.276031494140625, 0.278778076171875, 0.281524658203125, 0.284271240234375, 0.287017822265625, 0.289733886718750, 0.292480468750000, 0.295227050781250, 0.297943115234375, 0.300659179687500, 0.303405761718750, 0.306121826171875, 0.308837890625000, 0.311553955078125, 0.314270019531250, 0.316986083984375, 0.319702148437500, 0.322418212890625, 0.325103759765625, 0.327819824218750, 0.330505371093750, 0.333221435546875, 0.335906982421875, 0.338592529296875, 0.341308593750000, 0.343994140625000, 0.346679687500000, 0.349334716796875, 0.352020263671875, 0.354705810546875, 0.357391357421875, 0.360046386718750, 0.362701416015625, 0.365386962890625, 0.368041992187500, 0.370697021484375, 0.373352050781250, 0.376007080078125, 0.378662109375000, 0.381317138671875, 0.383941650390625, 0.386596679687500, 0.389221191406250, 0.391876220703125, 0.394500732421875, 0.397125244140625, 0.399749755859375, 0.402374267578125, 0.404998779296875, 0.407623291015625, 0.410217285156250, 0.412841796875000, 0.415435791015625, 0.418029785156250, 0.420654296875000, 0.423248291015625, 0.425842285156250, 0.428405761718750, 0.430999755859375, 0.433593750000000, 0.436157226562500, 0.438751220703125, 0.441314697265625, 0.443878173828125, 0.446441650390625, 0.449005126953125, 0.451568603515625, 0.454101562500000, 0.456665039062500, 0.459197998046875, 0.461761474609375, 0.464294433593750, 0.466827392578125, 0.469360351562500, 0.471893310546875, 0.474426269531250, 0.476928710937500, 0.479461669921875, 0.481964111328125, 0.484466552734375, 0.486968994140625, 0.489471435546875, 0.491973876953125, 0.494476318359375, 0.496948242187500, 0.499450683593750, 0.501922607421875, 0.504394531250000, 0.506866455078125, 0.509338378906250, 0.511810302734375, 0.514251708984375, 0.516723632812500, 0.519165039062500, 0.521636962890625, 0.524078369140625, 0.526519775390625, 0.528930664062500, 0.531372070312500, 0.533813476562500, 0.536224365234375, 0.538635253906250, 0.541046142578125, 0.543457031250000, 0.545867919921875, 0.548278808593750, 0.550659179687500, 0.553070068359375, 0.555450439453125, 0.557830810546875, 0.560211181640625, 0.562591552734375, 0.564941406250000, 0.567321777343750, 0.569671630859375, 0.572021484375000, 0.574371337890625, 0.576721191406250, 0.579071044921875, 0.581390380859375, 0.583740234375000, 0.586059570312500, 0.588378906250000, 0.590698242187500, 0.593017578125000, 0.595336914062500, 0.597625732421875, 0.599914550781250, 0.602233886718750, 0.604522705078125, 0.606781005859375, 0.609069824218750, 0.611358642578125, 0.613616943359375, 0.615875244140625, 0.618133544921875, 0.620391845703125, 0.622650146484375, 0.624877929687500, 0.627136230468750, 0.629364013671875, 0.631591796875000, 0.633819580078125, 0.636016845703125, 0.638244628906250, 0.640441894531250, 0.642639160156250, 0.644836425781250, 0.647033691406250, 0.649230957031250, 0.651397705078125, 0.653594970703125, 0.655761718750000, 0.657928466796875, 0.660095214843750, 0.662231445312500, 0.664398193359375, 0.666534423828125, 0.668670654296875, 0.670806884765625, 0.672943115234375, 0.675048828125000, 0.677185058593750, 0.679290771484375, 0.681396484375000, 0.683502197265625, 0.685577392578125, 0.687683105468750, 0.689758300781250, 0.691833496093750, 0.693908691406250, 0.695983886718750, 0.698028564453125, 0.700073242187500, 0.702148437500000, 0.704193115234375, 0.706207275390625, 0.708251953125000, 0.710266113281250, 0.712310791015625, 0.714324951171875, 0.716308593750000, 0.718322753906250, 0.720306396484375, 0.722320556640625, 0.724304199218750, 0.726287841796875, 0.728240966796875, 0.730224609375000, 0.732177734375000, 0.734130859375000, 0.736083984375000, 0.738037109375000, 0.739959716796875, 0.741882324218750, 0.743835449218750, 0.745727539062500, 0.747650146484375, 0.749572753906250, 0.751464843750000, 0.753356933593750, 0.755249023437500, 0.757141113281250, 0.759002685546875, 0.760864257812500, 0.762725830078125, 0.764587402343750, 0.766448974609375, 0.768280029296875, 0.770141601562500, 0.771972656250000, 0.773773193359375, 0.775604248046875, 0.777435302734375, 0.779235839843750, 0.781036376953125, 0.782806396484375, 0.784606933593750, 0.786376953125000, 0.788177490234375, 0.789947509765625, 0.791687011718750, 0.793457031250000, 0.795196533203125, 0.796936035156250, 0.798675537109375, 0.800415039062500, 0.802124023437500, 0.803833007812500, 0.805541992187500, 0.807250976562500, 0.808959960937500, 0.810638427734375, 0.812316894531250, 0.813995361328125, 0.815673828125000, 0.817321777343750, 0.819000244140625, 0.820648193359375, 0.822265625000000, 0.823913574218750, 0.825531005859375, 0.827178955078125, 0.828765869140625, 0.830383300781250, 0.832000732421875, 0.833587646484375, 0.835174560546875, 0.836761474609375, 0.838317871093750, 0.839904785156250, 0.841461181640625, 0.843017578125000, 0.844543457031250, 0.846099853515625, 0.847625732421875, 0.849151611328125, 0.850677490234375, 0.852172851562500, 0.853698730468750, 0.855194091796875, 0.856658935546875, 0.858154296875000, 0.859619140625000, 0.861114501953125, 0.862548828125000, 0.864013671875000, 0.865478515625000, 0.866912841796875, 0.868347167968750, 0.869781494140625, 0.871185302734375, 0.872589111328125, 0.873992919921875, 0.875396728515625, 0.876800537109375, 0.878173828125000, 0.879547119140625, 0.880920410156250, 0.882263183593750, 0.883636474609375, 0.884979248046875, 0.886322021484375, 0.887634277343750, 0.888977050781250, 0.890289306640625, 0.891601562500000, 0.892913818359375, 0.894195556640625, 0.895477294921875, 0.896759033203125, 0.898040771484375, 0.899291992187500, 0.900573730468750, 0.901824951171875, 0.903045654296875, 0.904296875000000, 0.905517578125000, 0.906738281250000, 0.907958984375000, 0.909149169921875, 0.910339355468750, 0.911529541015625, 0.912719726562500, 0.913909912109375, 0.915069580078125, 0.916229248046875, 0.917388916015625, 0.918518066406250, 0.919677734375000, 0.920806884765625, 0.921905517578125, 0.923034667968750, 0.924133300781250, 0.925231933593750, 0.926330566406250, 0.927398681640625, 0.928497314453125, 0.929565429687500, 0.930603027343750, 0.931671142578125, 0.932708740234375, 0.933746337890625, 0.934783935546875, 0.935791015625000, 0.936828613281250, 0.937835693359375, 0.938812255859375, 0.939819335937500, 0.940795898437500, 0.941772460937500, 0.942749023437500, 0.943695068359375, 0.944641113281250, 0.945587158203125, 0.946533203125000, 0.947448730468750, 0.948364257812500, 0.949279785156250, 0.950195312500000, 0.951080322265625, 0.951965332031250, 0.952850341796875, 0.953735351562500, 0.954589843750000, 0.955444335937500, 0.956298828125000, 0.957153320312500, 0.957977294921875, 0.958801269531250, 0.959625244140625, 0.960418701171875, 0.961212158203125, 0.962005615234375, 0.962799072265625, 0.963592529296875, 0.964355468750000, 0.965118408203125, 0.965850830078125, 0.966613769531250, 0.967346191406250, 0.968078613281250, 0.968780517578125, 0.969512939453125, 0.970214843750000, 0.970916748046875, 0.971588134765625, 0.972290039062500, 0.972961425781250, 0.973602294921875, 0.974273681640625, 0.974914550781250, 0.975555419921875, 0.976196289062500, 0.976806640625000, 0.977416992187500, 0.978027343750000, 0.978637695312500, 0.979217529296875, 0.979797363281250, 0.980377197265625, 0.980957031250000, 0.981506347656250, 0.982055664062500, 0.982604980468750, 0.983123779296875, 0.983642578125000, 0.984161376953125, 0.984680175781250, 0.985168457031250, 0.985656738281250, 0.986145019531250, 0.986633300781250, 0.987091064453125, 0.987548828125000, 0.988006591796875, 0.988433837890625, 0.988891601562500, 0.989318847656250, 0.989715576171875, 0.990142822265625, 0.990539550781250, 0.990936279296875, 0.991302490234375, 0.991699218750000, 0.992065429687500, 0.992431640625000, 0.992767333984375, 0.993103027343750, 0.993438720703125, 0.993774414062500, 0.994079589843750, 0.994415283203125, 0.994689941406250, 0.994995117187500};
    //channelNumber = 1;

    //y[k]=Ay[k-1]+By[k-2]+Cy[k-3]+Dy[k-4]+Eu[k]+Fu[k-1]...
    for (int channel = 0; channel < channelNumber; channel++) {
        auto channelSamples = buffer.getWritePointer(channel);
        //auto channelSamples = t;
        for (int i = 0; i < buffer.getNumSamples(); i++) {
            float tmp = channelSamples[i];
            float test= this->A * this->yBuffer[channel][0] + this->B * this->yBuffer[channel][1] + this->C * this->yBuffer[channel][2] + this->D * this->yBuffer[channel][3] + this->E * channelSamples[i] + this->F * this->uBuffer[channel][0] + this->G * this->uBuffer[channel][1] + this->H * this->uBuffer[channel][2] + this->I * this->uBuffer[channel][3];
            if (test != test || isinf(test) || test>10 || test<-10) {
                throw "miafaszvan";
            }
            channelSamples[i] = this->A * this->yBuffer[channel][0] + this->B * this->yBuffer[channel][1] + this->C * this->yBuffer[channel][2] + this->D * this->yBuffer[channel][3] + this->E * channelSamples[i] + this->F * this->uBuffer[channel][0] + this->G * this->uBuffer[channel][1] + this->H * this->uBuffer[channel][2] + this->I * this->uBuffer[channel][3];
            
            //illene körforgó bufferrel
            //
            this->yBuffer[channel][3] = this->yBuffer[channel][2];
            this->yBuffer[channel][2] = this->yBuffer[channel][1];
            this->yBuffer[channel][1] = this->yBuffer[channel][0];
            this->yBuffer[channel][0] = channelSamples[i];
            this->uBuffer[channel][3] = this->uBuffer[channel][2];
            this->uBuffer[channel][2] = this->uBuffer[channel][1];
            this->uBuffer[channel][1] = this->uBuffer[channel][0];
            this->uBuffer[channel][0] = tmp;
        }
    }
}

void Stage4::configure(double sampleRate) {

    this->sampleRate = static_cast<float>(sampleRate);
    double T = 1 / sampleRate;
    double B = static_cast<double>(*this->bassParameter);
    double M = static_cast<double>(*this->midParameter);
    double TR1 = static_cast<double>(*this->trebleParameter);
    double TR2 = 250000 + 10e-6 - TR1;

    double G = 1 / ((533.803148049091980882120328544040347976403257171 * B) / 2156795733372051183573361.206961570453890971553803245798488288819937280 + (0.00006274825849828609 * T) / 25353012004.56458802993406410752 + (0.000001726535807035033197328125 * M * T) / 696898287454.081973172991196020261297061888 + (0.000000000000417274442583990799 * T * TR1) / 166153.499473114484112975882535043072 + (0.000000000001670742678283540667 * T * TR2) / 664613.997892457936451903530140172288 + (8.311478524666663169915429011011667535841530076396790734055467 * B * T * T) / 84249833334845.749358334422146936345855116076320439289003448782028800000000 + (0.000041526407829211405506621249979618093590247 * B * T * T * T) / 45671926.166590716193865151022383844364247891968000000 + (0.000002876968547602381393300375 * M * T * T) / 21267647.932558653966460912964485513216 + (0.0000044889515712632369795 * M * T * T * T) / 4056481.9207303340847894502572032 + (0.000000000008907027864639130449 * T * T * TR1) / 41538.374868278621028243970633760768 + (0.0000123013093165950040607 * T * T * TR2) / 2076918743.4139310514121985316880384 + (0.0000000163778023660334793 * T * T * T * TR1) / 16225927.6829213363391578010288128 + (0.0000074615473641083918805 * T * T * T * TR2) / 16225927.6829213363391578010288128 + (0.56533735394714965953 * T * T) / 99035203.14283042199192993792 + (12.06709734821125355701 * T * T * T) / 24758800.78570760549798248448 + (0.88753337404040790093 * T * T * T * T) / 386856.26227668133590597632 + (0.00000000000000210670131504873518714752587925352439739887833231487 * B * M) / 18092513943.33065553493296640760748560207343510400633813116524750123642650624 + (0.000772835371751105509466483201611550253690231965608886373699 * B * T) / 1347997333357.531989733350754350981533681857221127028624055180512460800000 + (0.00000000000000002166612777375726275345076627619928471198342632047 * B * TR1) / 86271829.33488204734293444827846281815563886215212983193953155279749120000 + (0.00000000000000542186997491980660817151277233526158147562061268921 * B * TR2) / 21567957333.72051183573361206961570453890971553803245798488288819937280000000 + (0.0000000000151225952988341954994003693771715669011233696798888086076331 * B * M * T) / 1766847064.7783843295832975007429185158274838968756189581216062012926197760000000 + (0.0000000000000000016996626954833071005686756377081174575400777235392419 * B * M * TR1) / 452312848583.2663883733241601901871400518358776001584532791311875309106626560000000 + (0.0000000000000000000031431585364537710168411908757210846372022332966363 * B * M * TR2) / 862718293.3488204734293444827846281815563886215212983193953155279749120000000000 + (0.00000000000233550075354925391503173537230853462857826378248244977 * B * T * TR1) / 53919893334.30127958933403017403926134727428884508114496220722049843200000000 + (0.00000000412261973553721864922886160732134110648775511249713114767 * B * T * TR2) / 6739986666787.65994866675377175490766840928610563514312027590256230400000000000 + (0.0000000000000000000002166612777375726275345076627619928471198342632047 * B * TR1 * TR2) / 862718293.3488204734293444827846281815563886215212983193953155279749120000000000 + (0.00000000000001325328363144135256625 * M * T * TR1) / 223007451.98530623141535718272648361505980416 + (0.000000002541184116487107216125 * M * T * TR2) / 44601490397061.246283071436545296723011960832 + (0.000000000000437543965906950729 * T * TR1 * TR2) / 174224571863.520493293247799005065324265472 + (0.00000000011282566214941741196331206316836313917420183274501223107 * B * M * T * T) / 1347997333.35753198973335075435098153368185722112702862405518051246080000000 + (0.000000000005840277462905274569697905814833869 * B * T * T * TR1) / 14615016373.309029182036848327162830196559325429760000000 + (0.00000000102860640519897919097970773989424905323139 * B * T * T * TR2) / 11417981541.64767904846628775559596109106197299200000000000000 + (0.000000000000331070242683654831 * M * T * T * TR1) / 680564733.841876926926749214863536422912 + (0.000000000176480682067831445985 * M * T * T * TR2) / 1361129467.683753853853498429727072845824 + (0.000000000000137386963950127383 * T * T * TR1 * TR2) / 680564733.841876926926749214863536422912 + (0.000000000000158677981241598398251827782077795050627608578479 * B * M * T * TR1) / 4313591466744102.367146722413923140907781943107606491596976577639874560000000 + (0.0000000000000005588140199799516595213120320811324062825952139834602179 * B * M * T * TR2) / 67399866667.8765994866675377175490766840928610563514312027590256230400000000000000 + (0.0000000000000000000000031400185179358351816595313443767079292729603363 * B * M * TR1 * TR2) / 862718293348.8204734293444827846281815563886215212983193953155279749120000000000000 + (0.00000000000000002889914877592634211337934095020143 * B * T * TR1 * TR2) / 730750818665.45145910184241635814150982796627148800000000000000 + (0.00000000000000000020309163768128729 * M * T * TR1 * TR2) / 3568119231.76489970264571492362373784095686656);
    this->A =  - ((0.000041526407829211405506621249979618093590247 * B * T * T * T) / 22835963.083295358096932575511191922182123945984000000 - (0.0000000006274825849828609 * T) / 126765.0600228229401496703205376 - (0.00000000001726535807035033197328125 * M * T) / 3484491.43727040986586495598010130648530944 - (0.0000000417274442583990799 * T * TR1) / 8307674973.6557242056487941267521536 - (0.0000001670742678283540667 * T * TR2) / 33230699894.6228968225951765070086144 - (0.000000000000533803148049091980882120328544040347976403257171 * B) / 539198933.343012795893340301740392613472742888450811449622072204984320 + (0.0000044889515712632369795 * M * T * T * T) / 2028240.9603651670423947251286016 + (0.0000000163778023660334793 * T * T * T * TR1) / 8112963.8414606681695789005144064 + (0.0000074615473641083918805 * T * T * T * TR2) / 8112963.8414606681695789005144064 + (12.06709734821125355701 * T * T * T) / 12379400.39285380274899124224 + (88753.337404040790093 * T * T * T * T) / 9671406556.917033397649408 - (0.00000000000000210670131504873518714752587925352439739887833231487 * B * M) / 4523128485.83266388373324160190187140051835877600158453279131187530910662656 - (0.00000000772835371751105509466483201611550253690231965608886373699 * B * T) / 6739986.66678765994866675377175490766840928610563514312027590256230400000 - (0.00000000000000002166612777375726275345076627619928471198342632047 * B * TR1) / 21567957.33372051183573361206961570453890971553803245798488288819937280000 - (0.00000000000000542186997491980660817151277233526158147562061268921 * B * TR2) / 5391989333.43012795893340301740392613472742888450811449622072204984320000000 - (0.0000000000151225952988341954994003693771715669011233696798888086076331 * B * M * T) / 883423532.3891921647916487503714592579137419484378094790608031006463098880000000 - (0.000000000000000000000016996626954833071005686756377081174575400777235392419 * B * M * TR1) / 1130782.121458165970933310400475467850129589694000396133197827968827276656640000000 - (0.0000000000000000000031431585364537710168411908757210846372022332966363 * B * M * TR2) / 215679573.3372051183573361206961570453890971553803245798488288819937280000000000 - (0.00000000000233550075354925391503173537230853462857826378248244977 * B * T * TR1) / 26959946667.15063979466701508701963067363714442254057248110361024921600000000 - (0.0000000000000412261973553721864922886160732134110648775511249713114767 * B * T * TR2) / 33699933.3339382997433337688587745383420464305281757156013795128115200000000000 - (0.0000000000000000000002166612777375726275345076627619928471198342632047 * B * TR1 * TR2) / 215679573.3372051183573361206961570453890971553803245798488288819937280000000000 - (0.00000000000001325328363144135256625 * M * T * TR1) / 111503725.99265311570767859136324180752990208 - (0.00000000000002541184116487107216125 * M * T * TR2) / 223007451.98530623141535718272648361505980416 - (0.000000000000437543965906950729 * T * TR1 * TR2) / 87112285931.760246646623899502532662132736 - (0.00000000000000000158677981241598398251827782077795050627608578479 * B * M * T * TR1) / 21567957333.72051183573361206961570453890971553803245798488288819937280000000 - (0.0000000000000005588140199799516595213120320811324062825952139834602179 * B * M * T * TR2) / 33699933333.9382997433337688587745383420464305281757156013795128115200000000000000 - (0.000000000000000000000000000031400185179358351816595313443767079292729603363 * B * M * TR1 * TR2) / 2156795.733372051183573361206961570453890971553803245798488288819937280000000000000 - (0.0000000000000000000002889914877592634211337934095020143 * B * T * TR1 * TR2) / 3653754.0933272572955092120817907075491398313574400000000000000 - (0.00000000000000000020309163768128729 * M * T * TR1 * TR2) / 1784059615.88244985132285746181186892047843328) * G;
    this->B =  - ((0.000000000001601409444147275942646360985632121043929209771513 * B) / 1078397866.686025591786680603480785226945485776901622899244144409968640 - (0.00008311478524666663169915429011011667535841530076396790734055467 * B * T * T) / 421249166.67422874679167211073468172927558038160219644501724391014400000000 - (0.000002876968547602381393300375 * M * T * T) / 10633823.966279326983230456482242756608 - (0.0000008907027864639130449 * T * T * TR1) / 2076918743.4139310514121985316880384 - (0.0000123013093165950040607 * T * T * TR2) / 1038459371.7069655257060992658440192 - (0.56533735394714965953 * T * T) / 49517601.57141521099596496896 + (33282.501526515296221 * T * T * T * T) / 2417851639.229258349412352 + (0.00000000000000632010394514620556144257763776057319219663499694461 * B * M) / 9046256971.66532776746648320380374280103671755200316906558262375061821325312 + (0.00000000000000006499838332127178826035229882859785413595027896141 * B * TR1) / 43135914.66744102367146722413923140907781943107606491596976577639874560000 + (0.00000000000001626560992475941982451453831700578474442686183806763 * B * TR2) / 10783978666.86025591786680603480785226945485776901622899244144409968640000000 + (0.0000000000000000050989880864499213017060269131243523726202331706177257 * B * M * TR1) / 226156424291.6331941866620800950935700259179388000792266395655937654553313280000000 + (0.0000000000000000000094294756093613130505235726271632539116066998899089 * B * M * TR2) / 431359146.6744102367146722413923140907781943107606491596976577639874560000000000 + (0.0000000000000000000006499838332127178826035229882859785413595027896141 * B * TR1 * TR2) / 431359146.6744102367146722413923140907781943107606491596976577639874560000000000 - (0.00000000011282566214941741196331206316836313917420183274501223107 * B * M * T * T) / 673998666.67876599486667537717549076684092861056351431202759025623040000000 - (0.000000000005840277462905274569697905814833869 * B * T * T * TR1) / 7307508186.654514591018424163581415098279662714880000000 - (0.00000000102860640519897919097970773989424905323139 * B * T * T * TR2) / 5708990770.82383952423314387779798054553098649600000000000000 - (0.000000000000331070242683654831 * M * T * T * TR1) / 340282366.920938463463374607431768211456 - (0.000000000176480682067831445985 * M * T * T * TR2) / 680564733.841876926926749214863536422912 - (0.000000000000137386963950127383 * T * T * TR1 * TR2) / 340282366.920938463463374607431768211456 + (0.0000000000000000000000094200555538075055449785940331301237878188810089 * B * M * TR1 * TR2) / 431359146674.4102367146722413923140907781943107606491596976577639874560000000000000) * G;
    this->C =  - ((0.0000000006274825849828609 * T) / 126765.0600228229401496703205376 - (0.000000000000533803148049091980882120328544040347976403257171 * B) / 539198933.343012795893340301740392613472742888450811449622072204984320 + (0.00000000001726535807035033197328125 * M * T) / 3484491.43727040986586495598010130648530944 + (0.0000000417274442583990799 * T * TR1) / 8307674973.6557242056487941267521536 + (0.0000001670742678283540667 * T * TR2) / 33230699894.6228968225951765070086144 - (0.000041526407829211405506621249979618093590247 * B * T * T * T) / 22835963.083295358096932575511191922182123945984000000 - (0.0000044889515712632369795 * M * T * T * T) / 2028240.9603651670423947251286016 - (0.0000000163778023660334793 * T * T * T * TR1) / 8112963.8414606681695789005144064 - (0.0000074615473641083918805 * T * T * T * TR2) / 8112963.8414606681695789005144064 - (12.06709734821125355701 * T * T * T) / 12379400.39285380274899124224 + (88753.337404040790093 * T * T * T * T) / 9671406556.917033397649408 - (0.00000000000000210670131504873518714752587925352439739887833231487 * B * M) / 4523128485.83266388373324160190187140051835877600158453279131187530910662656 + (0.00000000772835371751105509466483201611550253690231965608886373699 * B * T) / 6739986.66678765994866675377175490766840928610563514312027590256230400000 - (0.00000000000000002166612777375726275345076627619928471198342632047 * B * TR1) / 21567957.33372051183573361206961570453890971553803245798488288819937280000 - (0.00000000000000542186997491980660817151277233526158147562061268921 * B * TR2) / 5391989333.43012795893340301740392613472742888450811449622072204984320000000 + (0.0000000000151225952988341954994003693771715669011233696798888086076331 * B * M * T) / 883423532.3891921647916487503714592579137419484378094790608031006463098880000000 - (0.000000000000000000000016996626954833071005686756377081174575400777235392419 * B * M * TR1) / 1130782.121458165970933310400475467850129589694000396133197827968827276656640000000 - (0.0000000000000000000031431585364537710168411908757210846372022332966363 * B * M * TR2) / 215679573.3372051183573361206961570453890971553803245798488288819937280000000000 + (0.00000000000233550075354925391503173537230853462857826378248244977 * B * T * TR1) / 26959946667.15063979466701508701963067363714442254057248110361024921600000000 + (0.0000000000000412261973553721864922886160732134110648775511249713114767 * B * T * TR2) / 33699933.3339382997433337688587745383420464305281757156013795128115200000000000 - (0.0000000000000000000002166612777375726275345076627619928471198342632047 * B * TR1 * TR2) / 215679573.3372051183573361206961570453890971553803245798488288819937280000000000 + (0.00000000000001325328363144135256625 * M * T * TR1) / 111503725.99265311570767859136324180752990208 + (0.00000000000002541184116487107216125 * M * T * TR2) / 223007451.98530623141535718272648361505980416 + (0.000000000000437543965906950729 * T * TR1 * TR2) / 87112285931.760246646623899502532662132736 + (0.00000000000000000158677981241598398251827782077795050627608578479 * B * M * T * TR1) / 21567957333.72051183573361206961570453890971553803245798488288819937280000000 + (0.0000000000000005588140199799516595213120320811324062825952139834602179 * B * M * T * TR2) / 33699933333.9382997433337688587745383420464305281757156013795128115200000000000000 - (0.000000000000000000000000000031400185179358351816595313443767079292729603363 * B * M * TR1 * TR2) / 2156795.733372051183573361206961570453890971553803245798488288819937280000000000000 + (0.0000000000000000000002889914877592634211337934095020143 * B * T * TR1 * TR2) / 3653754.0933272572955092120817907075491398313574400000000000000 + (0.00000000000000000020309163768128729 * M * T * TR1 * TR2) / 1784059615.88244985132285746181186892047843328) * G;
    this->D =  - ((0.000000000000533803148049091980882120328544040347976403257171 * B) / 2156795733.372051183573361206961570453890971553803245798488288819937280 - (0.00006274825849828609 * T) / 25353012004.56458802993406410752 - (0.00000000001726535807035033197328125 * M * T) / 6968982.87454081973172991196020261297061888 - (0.0000000417274442583990799 * T * TR1) / 16615349947.3114484112975882535043072 - (0.0000001670742678283540667 * T * TR2) / 66461399789.2457936451903530140172288 + (0.00008311478524666663169915429011011667535841530076396790734055467 * B * T * T) / 842498333.34845749358334422146936345855116076320439289003448782028800000000 - (0.000041526407829211405506621249979618093590247 * B * T * T * T) / 45671926.166590716193865151022383844364247891968000000 + (0.000002876968547602381393300375 * M * T * T) / 21267647.932558653966460912964485513216 - (0.0000044889515712632369795 * M * T * T * T) / 4056481.9207303340847894502572032 + (0.0000008907027864639130449 * T * T * TR1) / 4153837486.8278621028243970633760768 + (0.0000123013093165950040607 * T * T * TR2) / 2076918743.4139310514121985316880384 - (0.0000000163778023660334793 * T * T * T * TR1) / 16225927.6829213363391578010288128 - (0.0000074615473641083918805 * T * T * T * TR2) / 16225927.6829213363391578010288128 + (0.56533735394714965953 * T * T) / 99035203.14283042199192993792 - (12.06709734821125355701 * T * T * T) / 24758800.78570760549798248448 + (88753.337404040790093 * T * T * T * T) / 38685626227.668133590597632 + (0.00000000000000210670131504873518714752587925352439739887833231487 * B * M) / 18092513943.33065553493296640760748560207343510400633813116524750123642650624 - (0.00000000772835371751105509466483201611550253690231965608886373699 * B * T) / 13479973.33357531989733350754350981533681857221127028624055180512460800000 + (0.00000000000000002166612777375726275345076627619928471198342632047 * B * TR1) / 86271829.33488204734293444827846281815563886215212983193953155279749120000 + (0.00000000000000542186997491980660817151277233526158147562061268921 * B * TR2) / 21567957333.72051183573361206961570453890971553803245798488288819937280000000 - (0.0000000000151225952988341954994003693771715669011233696798888086076331 * B * M * T) / 1766847064.7783843295832975007429185158274838968756189581216062012926197760000000 + (0.000000000000000000000016996626954833071005686756377081174575400777235392419 * B * M * TR1) / 4523128.485832663883733241601901871400518358776001584532791311875309106626560000000 + (0.0000000000000000000031431585364537710168411908757210846372022332966363 * B * M * TR2) / 862718293.3488204734293444827846281815563886215212983193953155279749120000000000 - (0.00000000000233550075354925391503173537230853462857826378248244977 * B * T * TR1) / 53919893334.30127958933403017403926134727428884508114496220722049843200000000 - (0.0000000000000412261973553721864922886160732134110648775511249713114767 * B * T * TR2) / 67399866.6678765994866675377175490766840928610563514312027590256230400000000000 + (0.0000000000000000000002166612777375726275345076627619928471198342632047 * B * TR1 * TR2) / 862718293.3488204734293444827846281815563886215212983193953155279749120000000000 - (0.00000000000001325328363144135256625 * M * T * TR1) / 223007451.98530623141535718272648361505980416 - (0.00000000000002541184116487107216125 * M * T * TR2) / 446014903.97061246283071436545296723011960832 - (0.00000000000000000437543965906950729 * T * TR1 * TR2) / 1742245.71863520493293247799005065324265472 + (0.00000000011282566214941741196331206316836313917420183274501223107 * B * M * T * T) / 1347997333.35753198973335075435098153368185722112702862405518051246080000000 + (0.000000000005840277462905274569697905814833869 * B * T * T * TR1) / 14615016373.309029182036848327162830196559325429760000000 + (0.00000000102860640519897919097970773989424905323139 * B * T * T * TR2) / 11417981541.64767904846628775559596109106197299200000000000000 + (0.000000000000331070242683654831 * M * T * T * TR1) / 680564733.841876926926749214863536422912 + (0.000000000176480682067831445985 * M * T * T * TR2) / 1361129467.683753853853498429727072845824 + (0.000000000000137386963950127383 * T * T * TR1 * TR2) / 680564733.841876926926749214863536422912 - (0.00000000000000000158677981241598398251827782077795050627608578479 * B * M * T * TR1) / 43135914667.44102367146722413923140907781943107606491596976577639874560000000 - (0.0000000000000005588140199799516595213120320811324062825952139834602179 * B * M * T * TR2) / 67399866667.8765994866675377175490766840928610563514312027590256230400000000000000 + (0.000000000000000000000000000031400185179358351816595313443767079292729603363 * B * M * TR1 * TR2) / 8627182.933488204734293444827846281815563886215212983193953155279749120000000000000 - (0.0000000000000000000002889914877592634211337934095020143 * B * T * TR1 * TR2) / 7307508.1866545145910184241635814150982796627148800000000000000 - (0.00000000000000000020309163768128729 * M * T * TR1 * TR2) / 3568119231.76489970264571492362373784095686656) * G;
    this->E = ((0.000000000007408006819768664144938091315600625 * M * T) / 2993155.353253689176481146537402947624255349848014848 + (0.0000000003617190829965168074776892011073 * T * TR2) / 146150163.7330902918203684832716283019655932542976 + (0.000000157342640139290437216569684823032958709 * B * T * T) / 1784059.615882449851322857461811868920478433280000000 + (0.000000231131345852188573049635502142372958709 * M * T * T) / 1784059.615882449851322857461811868920478433280000000 + (0.0000000004421042452925981350493588234729 * T * T * TR2) / 2283596.3083295358096932575511191922182123945984 + (0.00000000000000026307458979130059779564508981687367599886093060875 * B * M) / 2261564242.91633194186662080095093570025917938800079226639565593765455331328 + (0.000000000066725393506136497610265041068005043497050407146375 * B * T) / 26959946.667150639794667015087019630673637144422540572481103610249216 + (0.00000000000000000533803148049091980882120328544040347976403257171 * B * TR2) / 21567957.33372051183573361206961570453890971553803245798488288819937280000 + (0.00000000001117516533620487983992144207642995468021393563218512423 * B * M * T) / 1347997333.35753198973335075435098153368185722112702862405518051246080000000 + (0.00000000000000000031400185179358351816595313443767079292729603363 * B * M * TR1) / 86271829334.88204734293444827846281815563886215212983193953155279749120000000 + (0.00000000000000000031400185179358351816595313443767079292729603363 * B * M * TR2) / 86271829334.88204734293444827846281815563886215212983193953155279749120000000 + (0.000000000000004421042452925981350493588234729 * B * T * TR1) / 114179815.416476790484662877555959610910619729920000000 + (0.000000000000004421042452925981350493588234729 * B * T * TR2) / 114179815.416476790484662877555959610910619729920000000 + (0.000000000000010903399274152626767439407189101 * M * T * TR1) / 191561942.608236107294793378393788647952342390272950272 + (0.000000000000010903399274152626767439407189101 * M * T * TR2) / 191561942.608236107294793378393788647952342390272950272) * G;
    this->F = ((0.0000000000000000000026707013078215478993 * M * T * T) / 174224571.8635204932932477990050653242654720000000 - (0.0000000003617190829965168074776892011073 * T * TR2) / 73075081.8665451459101842416358141509827966271488 - (0.000000000007408006819768664144938091315600625 * M * T) / 1496577.676626844588240573268701473812127674924007424 - (0.00000000000000026307458979130059779564508981687367599886093060875 * B * M) / 565391060.72908298546665520023773392506479484700019806659891398441363832832 - (0.000000000066725393506136497610265041068005043497050407146375 * B * T) / 13479973.333575319897333507543509815336818572211270286240551805124608 - (0.00000000000000000533803148049091980882120328544040347976403257171 * B * TR2) / 5391989.33343012795893340301740392613472742888450811449622072204984320000 - (0.00000000001117516533620487983992144207642995468021393563218512423 * B * M * T) / 673998666.67876599486667537717549076684092861056351431202759025623040000000 - (0.00000000000000000031400185179358351816595313443767079292729603363 * B * M * TR1) / 21567957333.72051183573361206961570453890971553803245798488288819937280000000 - (0.00000000000000000031400185179358351816595313443767079292729603363 * B * M * TR2) / 21567957333.72051183573361206961570453890971553803245798488288819937280000000 - (0.000000000000004421042452925981350493588234729 * B * T * TR1) / 57089907.708238395242331438777979805455309864960000000 - (0.000000000000004421042452925981350493588234729 * B * T * TR2) / 57089907.708238395242331438777979805455309864960000000 - (0.000000000000010903399274152626767439407189101 * M * T * TR1) / 95780971.304118053647396689196894323976171195136475136 - (0.000000000000010903399274152626767439407189101 * M * T * TR2) / 95780971.304118053647396689196894323976171195136475136) * G;
    this->G = ((0.00000000000000078922376937390179338693526945062102799658279182625 * B * M) / 1130782121.45816597093331040047546785012958969400039613319782796882727665664 - (0.000000231131345852188600397616894235023447541 * M * T * T) / 892029.807941224925661428730905934460239216640000000 - (0.0000000004421042452925981350493588234729 * T * T * TR2) / 1141798.1541647679048466287755595961091061972992 - (0.0157342640139290437216569684823032958709 * B * T * T) / 89202980794.1224925661428730905934460239216640000000 + (0.00000000000000001601409444147275942646360985632121043929209771513 * B * TR2) / 10783978.66686025591786680603480785226945485776901622899244144409968640000 + (0.00000000000000000094200555538075055449785940331301237878188810089 * B * M * TR1) / 43135914667.44102367146722413923140907781943107606491596976577639874560000000 + (0.00000000000000000094200555538075055449785940331301237878188810089 * B * M * TR2) / 43135914667.44102367146722413923140907781943107606491596976577639874560000000) * G;
    this->H = ((0.000000000007408006819768664144938091315600625 * M * T) / 1496577.676626844588240573268701473812127674924007424 + (0.0000000003617190829965168074776892011073 * T * TR2) / 73075081.8665451459101842416358141509827966271488 + (0.0000000000000000000026707013078215478993 * M * T * T) / 174224571.8635204932932477990050653242654720000000 - (0.00000000000000026307458979130059779564508981687367599886093060875 * B * M) / 565391060.72908298546665520023773392506479484700019806659891398441363832832 + (0.000000000066725393506136497610265041068005043497050407146375 * B * T) / 13479973.333575319897333507543509815336818572211270286240551805124608 - (0.00000000000000000533803148049091980882120328544040347976403257171 * B * TR2) / 5391989.33343012795893340301740392613472742888450811449622072204984320000 + (0.00000000001117516533620487983992144207642995468021393563218512423 * B * M * T) / 673998666.67876599486667537717549076684092861056351431202759025623040000000 - (0.00000000000000000031400185179358351816595313443767079292729603363 * B * M * TR1) / 21567957333.72051183573361206961570453890971553803245798488288819937280000000 - (0.00000000000000000031400185179358351816595313443767079292729603363 * B * M * TR2) / 21567957333.72051183573361206961570453890971553803245798488288819937280000000 + (0.000000000000004421042452925981350493588234729 * B * T * TR1) / 57089907.708238395242331438777979805455309864960000000 + (0.000000000000004421042452925981350493588234729 * B * T * TR2) / 57089907.708238395242331438777979805455309864960000000 + (0.000000000000010903399274152626767439407189101 * M * T * TR1) / 95780971.304118053647396689196894323976171195136475136 + (0.000000000000010903399274152626767439407189101 * M * T * TR2) / 95780971.304118053647396689196894323976171195136475136) * G;
    this->I = ((0.000000157342640139290437216569684823032958709 * B * T * T) / 1784059.615882449851322857461811868920478433280000000 - (0.0000000003617190829965168074776892011073 * T * TR2) / 146150163.7330902918203684832716283019655932542976 - (0.000000000007408006819768664144938091315600625 * M * T) / 2993155.353253689176481146537402947624255349848014848 + (0.000000231131345852188573049635502142372958709 * M * T * T) / 1784059.615882449851322857461811868920478433280000000 + (0.0000000004421042452925981350493588234729 * T * T * TR2) / 2283596.3083295358096932575511191922182123945984 + (0.00000000000000026307458979130059779564508981687367599886093060875 * B * M) / 2261564242.91633194186662080095093570025917938800079226639565593765455331328 - (0.000000000066725393506136497610265041068005043497050407146375 * B * T) / 26959946.667150639794667015087019630673637144422540572481103610249216 + (0.00000000000000000533803148049091980882120328544040347976403257171 * B * TR2) / 21567957.33372051183573361206961570453890971553803245798488288819937280000 - (0.00000000001117516533620487983992144207642995468021393563218512423 * B * M * T) / 1347997333.35753198973335075435098153368185722112702862405518051246080000000 + (0.00000000000000000031400185179358351816595313443767079292729603363 * B * M * TR1) / 86271829334.88204734293444827846281815563886215212983193953155279749120000000 + (0.00000000000000000031400185179358351816595313443767079292729603363 * B * M * TR2) / 86271829334.88204734293444827846281815563886215212983193953155279749120000000 - (0.000000000000004421042452925981350493588234729 * B * T * TR1) / 114179815.416476790484662877555959610910619729920000000 - (0.000000000000004421042452925981350493588234729 * B * T * TR2) / 114179815.416476790484662877555959610910619729920000000 - (0.000000000000010903399274152626767439407189101 * M * T * TR1) / 191561942.608236107294793378393788647952342390272950272 - (0.000000000000010903399274152626767439407189101 * M * T * TR2) / 191561942.608236107294793378393788647952342390272950272) * G;

}

void Stage4::initParameters(juce::AudioProcessorValueTreeState& vts) {
    this->bassParameter = vts.getRawParameterValue("bass");
    this->midParameter = vts.getRawParameterValue("mid");
    this->trebleParameter = vts.getRawParameterValue("treble");
}
